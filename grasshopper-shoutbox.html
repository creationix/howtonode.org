<!DOCTYPE html>
<html lang="en">
<!-- Mirrored from localhost:8080/grasshopper-shoutbox by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 13 Jul 2021 13:58:39 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head><meta charset="utf-8" /><title>Shoutbox with Grasshopper and CouchDB - How To Node - NodeJS</title><meta name="description" content="Learn the zen of coding in NodeJS." /><meta name="viewport" content="width=device-width" /><link href="style.css" rel="stylesheet" /><link href="print.css" rel="stylesheet" media="print" /><link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="feed.xml" /><link href="favicon.ico" rel="icon" type="image/x-icon" /></head><body><div id="container"><div id="header"><a href="index.html"><img src="logo.png" alt="How to Node" class="logo" /><div class="tagline">The zen of coding in node.js</div></a></div><div id="main"><div class="article"><h1><a href="grasshopper-shoutbox.html">Shoutbox with Grasshopper and CouchDB</a></h1><p class="old-node-warning">HEADS UP! This article was written for an older version of node.&nbsp;More up-to-date information may be available elsewhere.</p><p>This article demonstrates how a simple shoutbox can be built with <a href="http://github.com/tuxychandru/grasshopper">Grasshopper</a> using CouchDB for storing the shouts.  It is inspired by <a href="http://net.tutsplus.com/tutorials/ruby/from-codeigniter-to-ruby-on-rails-a-conversion/">this article</a> on Nettuts+. I have included the design artifacts from Dan's post to retain the look and feel of the final result.</p>

<p>If do not want to type in the code yourself, look at the <a href="http://github.com/tuxychandru/grasshopper/tree/master/examples/shoutbox/">complete source code</a> for this article.  The completed application would look like this.</p>

<p><img src="grasshopper-shoutbox/shoutbox.png" style="float: none"></img></p>

<h2>Setting Up</h2>

<p>To follow this article <a href="http://git-scm.com/">git</a>, <a href="http://nodejs.org/">node.js</a>, <a href="http://npmjs.org/">npm</a> and <a href="http://couchdb.apache.org/">CouchDB</a> have to be installed and configured on your system.</p>

<h3>Grasshopper</h3>

<p>Grasshopper is a feature-rich and flexible web application framework for node.js with support for most of the features web applications would need.  Install it with this command.</p>

<pre><code><span class="pln">sudo npm install grasshopper<br /></span></code></pre>

<h3>CouchDB Module for node.js</h3>

<p>Install the CouchDB module for node.js (<a href="http://github.com/felixge/node-couchdb">node-couchdb</a>) using these commands.</p>

<pre><code><span class="pln">sudo npm install couchdb<br /></span></code></pre>

<h2>Creating the Application</h2>

<p>Grasshopper does not impose any specific structure in which the files of you project should be organized.  For our shoutbox, we'd be using this directory structure.</p>

<pre><code><span class="pln">shoutbox</span><span class="pun">/</span><span class="pln"><br /></span><span class="pun">|--</span><span class="pln"> app<br /></span><span class="pun">|</span><span class="pln"> &nbsp; </span><span class="pun">|--</span><span class="pln"> controller</span><span class="pun">.</span><span class="pln">js<br /></span><span class="pun">|</span><span class="pln"> &nbsp; </span><span class="pun">|--</span><span class="pln"> model</span><span class="pun">.</span><span class="pln">js<br /></span><span class="pun">|</span><span class="pln"> &nbsp; </span><span class="str">`-- shoutRepository.js<br />|-- boot.js<br />|-- createdb.js<br />|-- images<br />|-- stylesheets<br />`</span><span class="pun">--</span><span class="pln"> views<br />&nbsp; &nbsp; </span><span class="pun">|--</span><span class="pln"> index</span><span class="pun">.</span><span class="pln">html<br />&nbsp; &nbsp; </span><span class="str">`-- layout.html<br /></span></code></pre>

<p>From this point all locations mentioned will be relative to the 'shoutbox' directory.  Create it with this command.</p>

<pre><code><span class="pln">mkdir </span><span class="pun">-</span><span class="pln">p shoutbox</span><span class="pun">/{</span><span class="pln">app</span><span class="pun">,</span><span class="pln">images</span><span class="pun">,</span><span class="pln">stylesheets</span><span class="pun">,</span><span class="pln">views</span><span class="pun">}</span><span class="pln"><br /></span></code></pre>

<p>Create the CouchDB database for storing shouts by creating a file named <code>createdb.js</code> with the following content and executing it with <code>node createdb.js</code>.</p>

<div class="snippet"><a href="grasshopper-shoutbox/createdb.js" class="code-link">createdb.js</a><pre><code><span class="kwd">var</span><span class="pln"> couchdb </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'couchdb'</span><span class="pun">),</span><span class="pln"><br />&nbsp; &nbsp; client </span><span class="pun">=</span><span class="pln"> couchdb</span><span class="pun">.</span><span class="pln">createClient</span><span class="pun">();</span><span class="pln"><br /><br />client</span><span class="pun">.</span><span class="pln">request</span><span class="pun">(</span><span class="str">'put'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'/shout'</span><span class="pun">);</span><span class="pln"><br /><br />client</span><span class="pun">.</span><span class="pln">db</span><span class="pun">(</span><span class="str">'shout'</span><span class="pun">).</span><span class="pln">saveDesign</span><span class="pun">(</span><span class="str">'shout'</span><span class="pun">,</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; views</span><span class="pun">:</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; all</span><span class="pun">:</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; map</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">doc</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; emit</span><span class="pun">(</span><span class="kwd">null</span><span class="pun">,</span><span class="pln"> doc</span><span class="pun">);</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"><br /></span><span class="pun">});</span></code></pre></div>

<h2>Model</h2>

<p>Grasshopper provides various features like, validation and ability to update models from request parameters, to make the development of your application's model layer simple.</p>

<p>Our shoutbox application has a single model named <code>Shout</code> in <code>app/model.js</code>.</p>

<div class="snippet"><a href="grasshopper-shoutbox/app/model.js" class="code-link">app/model.js</a><pre><code><span class="kwd">var</span><span class="pln"> gh </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'grasshopper'</span><span class="pun">),</span><span class="pln"><br />&nbsp; &nbsp; crypto </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'crypto'</span><span class="pun">);</span><span class="pln"><br /><br /></span><span class="kwd">function</span><span class="pln"> </span><span class="typ">Shout</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br /></span><span class="pun">}</span><span class="pln"><br /><br />exports</span><span class="pun">.</span><span class="typ">Shout</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> gh</span><span class="pun">.</span><span class="pln">initModel</span><span class="pun">(</span><span class="typ">Shout</span><span class="pun">,</span><span class="pln"> </span><span class="str">'name'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'email'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'message'</span><span class="pun">);</span><span class="pln"><br /><br /></span><span class="typ">Shout</span><span class="pun">.</span><span class="pln">prototype</span><span class="pun">.</span><span class="pln">validate </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">validateRequired</span><span class="pun">(</span><span class="str">'name'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'Name is required.'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">);</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">validateRequired</span><span class="pun">(</span><span class="str">'email'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'Email is required.'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">);</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">validateRequired</span><span class="pun">(</span><span class="str">'message'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'Message is required.'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">);</span><span class="pln"><br /></span><span class="pun">};</span><span class="pln"><br /><br /></span><span class="typ">Shout</span><span class="pun">.</span><span class="pln">prototype</span><span class="pun">.</span><span class="pln">mailHash </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="kwd">return</span><span class="pln"> crypto</span><span class="pun">.</span><span class="pln">createHash</span><span class="pun">(</span><span class="str">'md5'</span><span class="pun">).</span><span class="pln">update</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">email</span><span class="pun">()).</span><span class="pln">digest</span><span class="pun">(</span><span class="str">'hex'</span><span class="pun">);</span><span class="pln"><br /></span><span class="pun">};</span></code></pre></div>

<p>We create a simple class named <code>Shout</code> and initialize it using <code>gh.initModel()</code>.  This method mixes validation and updation methods into the model class.  It takes the constructor of the model and the properties of the model as arguments. It creates a method for each property on the model which is used to read and write a field whose name is the property name prefixed with a '_'. For example, name() to read and write _name. The method reads the field if no argument is passed else writes the given value.</p>

<p>We then add the necessary validations.  We have hard coded the error messages as we don't care about internationalization here.  The <a href="http://wiki.github.com/tuxychandru/grasshopper/validation-api">validation API</a> of Grasshopper does a lot more.</p>

<p>We also add a function to generate an MD5 hash of the email which will be needed to retrieve the Gravatar for shouts.</p>

<h2>Repository</h2>

<p><a href="http://martinfowler.com/eaaCatalog/repository.html">Repositories</a> are used for data access.  Let's create a repository to store and retrieve shouts from our CouchDB database using <a href="http://github.com/felixge/node-couchdb">node-couchdb</a> in <code>app/shoutRepository.js</code>. The <code>save()</code> function saves a shout as a CouchDB object, while the <code>all()</code> function retrieves all documents in the database as an array of <code>Shout</code> instances.</p>

<div class="snippet"><a href="grasshopper-shoutbox/app/shoutRepository.js" class="code-link">app/shoutRepository.js</a><pre><code><span class="kwd">var</span><span class="pln"> couchdb </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'couchdb'</span><span class="pun">),</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="typ">Shout</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'./model'</span><span class="pun">).</span><span class="typ">Shout</span><span class="pun">;</span><span class="pln"><br /><br />exports</span><span class="pun">.</span><span class="pln">all </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">cb</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="kwd">var</span><span class="pln"> db </span><span class="pun">=</span><span class="pln"> couchdb</span><span class="pun">.</span><span class="pln">createClient</span><span class="pun">().</span><span class="pln">db</span><span class="pun">(</span><span class="str">'shout'</span><span class="pun">);</span><span class="pln"><br />&nbsp; &nbsp; db</span><span class="pun">.</span><span class="pln">view</span><span class="pun">(</span><span class="str">'shout'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'all'</span><span class="pun">,</span><span class="pln"> </span><span class="pun">{},</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">err</span><span class="pun">,</span><span class="pln"> res</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">if</span><span class="pun">(!</span><span class="pln">err</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">var</span><span class="pln"> shouts </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[]</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; res</span><span class="pun">.</span><span class="pln">rows</span><span class="pun">.</span><span class="pln">forEach</span><span class="pun">(</span><span class="kwd">function</span><span class="pun">(</span><span class="pln">row</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">var</span><span class="pln"> shout </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Shout</span><span class="pun">();</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; shout</span><span class="pun">.</span><span class="pln">name</span><span class="pun">(</span><span class="pln">row</span><span class="pun">.</span><span class="pln">value</span><span class="pun">.</span><span class="pln">name</span><span class="pun">)</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="pun">.</span><span class="pln">email</span><span class="pun">(</span><span class="pln">row</span><span class="pun">.</span><span class="pln">value</span><span class="pun">.</span><span class="pln">email</span><span class="pun">)</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="pun">.</span><span class="pln">message</span><span class="pun">(</span><span class="pln">row</span><span class="pun">.</span><span class="pln">value</span><span class="pun">.</span><span class="pln">message</span><span class="pun">);</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; shouts</span><span class="pun">.</span><span class="pln">push</span><span class="pun">(</span><span class="pln">shout</span><span class="pun">);</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">});</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; cb</span><span class="pun">(</span><span class="pln">err</span><span class="pun">,</span><span class="pln"> shouts</span><span class="pun">);</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="pun">});</span><span class="pln"><br /></span><span class="pun">};</span><span class="pln"><br /><br />exports</span><span class="pun">.</span><span class="pln">save </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">shout</span><span class="pun">,</span><span class="pln"> cb</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="kwd">var</span><span class="pln"> doc </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; name</span><span class="pun">:</span><span class="pln"> shout</span><span class="pun">.</span><span class="pln">name</span><span class="pun">(),</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; email</span><span class="pun">:</span><span class="pln"> shout</span><span class="pun">.</span><span class="pln">email</span><span class="pun">(),</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; message</span><span class="pun">:</span><span class="pln"> shout</span><span class="pun">.</span><span class="pln">message</span><span class="pun">()</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="pun">};</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="kwd">var</span><span class="pln"> db </span><span class="pun">=</span><span class="pln"> couchdb</span><span class="pun">.</span><span class="pln">createClient</span><span class="pun">().</span><span class="pln">db</span><span class="pun">(</span><span class="str">'shout'</span><span class="pun">);</span><span class="pln"><br />&nbsp; &nbsp; db</span><span class="pun">.</span><span class="pln">saveDoc</span><span class="pun">(</span><span class="pln">doc</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">err</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; cb</span><span class="pun">(</span><span class="pln">err</span><span class="pun">);</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="pun">});</span><span class="pln"><br /></span><span class="pun">};</span></code></pre></div>

<h2>Controller</h2>

<p>Controllers in Grasshopper are just functions which are invoked with a <code>RequestContext</code> as the <code>this</code> context.  Our Shoutbox has 2 controllers, one to display all the available shouts along with a form to add new shouts and another to save new shouts and redirect back to the previous list.</p>

<h3>Controller to list shouts</h3>

<p>This controller reads all the shouts from the repository, adds them to the model of the current <code>RequestContext</code> (not to be confused with application models).  It then renders the <code>index</code> view (note that the view name doesn't include an extention).</p>

<pre><code><span class="pln">gh</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="str">'/'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="kwd">var</span><span class="pln"> </span><span class="kwd">self</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">;</span><span class="pln"><br />&nbsp; &nbsp; shoutRepo</span><span class="pun">.</span><span class="pln">all</span><span class="pun">(</span><span class="kwd">function</span><span class="pun">(</span><span class="pln">err</span><span class="pun">,</span><span class="pln"> shouts</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">model</span><span class="pun">[</span><span class="str">'shout'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Shout</span><span class="pun">();</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">model</span><span class="pun">[</span><span class="str">'shouts'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> shouts</span><span class="pun">;</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">render</span><span class="pun">(</span><span class="str">'index'</span><span class="pun">);</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="pun">});</span><span class="pln"><br /></span><span class="pun">});</span><span class="pln"><br /></span></code></pre>

<p><code>self.model['shout'] = new Shout();</code> is needed as the index view includes a form which uses a <code>Shout</code> model to add new a shout.</p>

<h3>Controller to save a shout</h3>

<p>This controller creates a new <code>Shout</code> and updates its properties from the 'shout' object in request parameters.  It then checks if the new shout is valid and saves it to the database through the repository and redirects back to the previous controller.</p>

<p>It also sets a flash message thanking the user for shouting.  Flash messages are not lost during redirection.  They are retained until the next non-redirect response.  This makes it useful for displaying notifications to the user after a <a href="http://en.wikipedia.org/wiki/Post/Redirect/Get">PRG</a>.</p>

<p>If the input is invalid, it adds the invalid shout to the model and renders the <code>index</code> view again which displays the errors.  It also loads all the shouts as the page would display existing shouts along with the error messages.</p>

<pre><code><span class="pln">gh</span><span class="pun">.</span><span class="pln">post</span><span class="pun">(</span><span class="str">'/'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="kwd">var</span><span class="pln"> </span><span class="kwd">self</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">;</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="kwd">var</span><span class="pln"> shout </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Shout</span><span class="pun">().</span><span class="pln">update</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="kwd">params</span><span class="pun">[</span><span class="str">'shout'</span><span class="pun">]);</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">shout</span><span class="pun">.</span><span class="pln">isValid</span><span class="pun">())</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; shoutRepo</span><span class="pun">.</span><span class="pln">save</span><span class="pun">(</span><span class="pln">shout</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">flash</span><span class="pun">[</span><span class="str">'success'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="str">'Thanks for shouting!'</span><span class="pun">;</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">redirect</span><span class="pun">(</span><span class="str">'/'</span><span class="pun">);</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">});</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; shoutRepo</span><span class="pun">.</span><span class="pln">all</span><span class="pun">(</span><span class="kwd">function</span><span class="pun">(</span><span class="pln">err</span><span class="pun">,</span><span class="pln"> shouts</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">model</span><span class="pun">[</span><span class="str">'shouts'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> shouts</span><span class="pun">;</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">model</span><span class="pun">[</span><span class="str">'shout'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> shout</span><span class="pun">;</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">render</span><span class="pun">(</span><span class="str">'index'</span><span class="pun">);</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">});</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"><br /></span><span class="pun">});</span><span class="pln"><br /></span></code></pre>

<p>The complete <code>app/controller.js</code> looks like this.</p>

<div class="snippet"><a href="grasshopper-shoutbox/app/controller.js" class="code-link">app/controller.js</a><pre><code><span class="kwd">var</span><span class="pln"> gh </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'grasshopper'</span><span class="pun">),</span><span class="pln"><br />&nbsp; &nbsp; shoutRepo </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'./shoutRepository'</span><span class="pun">),</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="typ">Shout</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'./model'</span><span class="pun">).</span><span class="typ">Shout</span><span class="pun">;</span><span class="pln"><br /><br />gh</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="str">'/'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="kwd">var</span><span class="pln"> </span><span class="kwd">self</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">;</span><span class="pln"><br />&nbsp; &nbsp; shoutRepo</span><span class="pun">.</span><span class="pln">all</span><span class="pun">(</span><span class="kwd">function</span><span class="pun">(</span><span class="pln">err</span><span class="pun">,</span><span class="pln"> shouts</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">model</span><span class="pun">[</span><span class="str">'shout'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Shout</span><span class="pun">();</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">model</span><span class="pun">[</span><span class="str">'shouts'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> shouts</span><span class="pun">;</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">render</span><span class="pun">(</span><span class="str">'index'</span><span class="pun">);</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="pun">});</span><span class="pln"><br /></span><span class="pun">});</span><span class="pln"><br /><br />gh</span><span class="pun">.</span><span class="pln">post</span><span class="pun">(</span><span class="str">'/'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="kwd">var</span><span class="pln"> </span><span class="kwd">self</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">;</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="kwd">var</span><span class="pln"> shout </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Shout</span><span class="pun">().</span><span class="pln">update</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="kwd">params</span><span class="pun">[</span><span class="str">'shout'</span><span class="pun">]);</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">shout</span><span class="pun">.</span><span class="pln">isValid</span><span class="pun">())</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; shoutRepo</span><span class="pun">.</span><span class="pln">save</span><span class="pun">(</span><span class="pln">shout</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">flash</span><span class="pun">[</span><span class="str">'success'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="str">'Thanks for shouting!'</span><span class="pun">;</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">redirect</span><span class="pun">(</span><span class="str">'/'</span><span class="pun">);</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">});</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; shoutRepo</span><span class="pun">.</span><span class="pln">all</span><span class="pun">(</span><span class="kwd">function</span><span class="pun">(</span><span class="pln">err</span><span class="pun">,</span><span class="pln"> shouts</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">model</span><span class="pun">[</span><span class="str">'shouts'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> shouts</span><span class="pun">;</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">model</span><span class="pun">[</span><span class="str">'shout'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> shout</span><span class="pun">;</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">render</span><span class="pun">(</span><span class="str">'index'</span><span class="pun">);</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">});</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"><br /></span><span class="pun">});</span></code></pre></div>

<h2>Layout</h2>

<p>Grasshopper allows having an application wide layout into which the views of requests would be embedded.  You can specify the layout file of your application with this configuration.</p>

<pre><code><span class="pln">gh</span><span class="pun">.</span><span class="pln">configure</span><span class="pun">({</span><span class="pln"><br />&nbsp; &nbsp; layout</span><span class="pun">:</span><span class="pln"> </span><span class="str">'views/layout'</span><span class="pln"><br /></span><span class="pun">});</span><span class="pln"><br /></span></code></pre>

<p>The layout file can use this piece of code to specify the location where the contents of the views have to be included.</p>

<pre><code><span class="pun">&lt;%</span><span class="pln"> include</span><span class="pun">(</span><span class="pln">view</span><span class="pun">);</span><span class="pln"> %&gt;<br /></span></code></pre>

<p>The layout for our shoutbox would look like this.</p>

<div class="snippet"><a href="grasshopper-shoutbox/views/layout.html" class="code-link">views/layout.html</a><pre><code><span class="dec">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"&gt;</span><span class="pln"><br /><br /></span><span class="tag">&lt;html&gt;</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="tag">&lt;head&gt;</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;title&gt;</span><span class="pln">Shoutbox in Grasshopper</span><span class="tag">&lt;/title&gt;</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;link</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"/stylesheets/style.css"</span><span class="pln"> </span><span class="atn">rel</span><span class="pun">=</span><span class="atv">"stylesheet"</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"text/css"</span><span class="tag">&gt;&lt;/link&gt;</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="tag">&lt;/head&gt;</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="tag">&lt;body&gt;</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"container"</span><span class="tag">&gt;</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;h1&gt;</span><span class="pln">Shoutbox</span><span class="tag">&lt;/h1&gt;</span><span class="pln"><br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"boxtop"</span><span class="tag">&gt;&lt;/div&gt;</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"content"</span><span class="tag">&gt;</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">&lt;%</span><span class="pln"> include</span><span class="pun">(</span><span class="pln">view</span><span class="pun">);</span><span class="pln"> %&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;/div&gt;</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"boxbot"</span><span class="tag">&gt;&lt;/div&gt;</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;/div&gt;</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="tag">&lt;/body&gt;</span><span class="pln"><br /></span><span class="tag">&lt;/html&gt;</span></code></pre></div>

<h2>View</h2>

<p>Views in Grasshopper can embed javascript with <code>&lt;% %&gt;</code> for code to be executed and <code>&lt;%= %&gt;</code> for code whose value is to be included in the response.</p>

<p>Our shoutbox has a single view as it does all the work on a single page.  At the top the page it displays all the errors in the shout if any.  It uses the <code>errors()</code> view helper to retrieve all the error messages in the shout as an array.  It then checks whether there is a flash message available to be displayed and displays it.</p>

<pre><code><span class="pun">&lt;%</span><span class="pln"> </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">shout</span><span class="pun">.</span><span class="pln">errors</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> %&gt;<br />&nbsp; &nbsp; </span><span class="tag">&lt;p</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"error"</span><span class="tag">&gt;</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">&lt;%</span><span class="pln">h errors</span><span class="pun">(</span><span class="pln">shout</span><span class="pun">).</span><span class="pln">join</span><span class="pun">(</span><span class="str">'&lt;/p&gt;&lt;p class="error"&gt;'</span><span class="pun">)</span><span class="pln"> %&gt;<br />&nbsp; &nbsp; </span><span class="tag">&lt;/p&gt;</span><span class="pln"><br /></span><span class="pun">&lt;%</span><span class="pln"> </span><span class="pun">}</span><span class="pln"> %&gt;<br /></span><span class="pun">&lt;%</span><span class="pln"> </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">flash</span><span class="pun">[</span><span class="str">'success'</span><span class="pun">])</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> %&gt;<br />&nbsp; &nbsp; </span><span class="tag">&lt;p</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"success"</span><span class="tag">&gt;</span><span class="pun">&lt;%=</span><span class="pln"> flash</span><span class="pun">[</span><span class="str">'success'</span><span class="pun">]</span><span class="pln"> %&gt;</span><span class="tag">&lt;/p&gt;</span><span class="pln"><br /></span><span class="pun">&lt;%</span><span class="pln"> </span><span class="pun">}</span><span class="pln"> %&gt;<br /></span></code></pre>

<p>It then lists all the available shouts including the name and gravatar of the person who shouted.</p>

<pre><code><span class="tag">&lt;ul&gt;</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="pun">&lt;%</span><span class="pln"> shouts</span><span class="pun">.</span><span class="pln">forEach</span><span class="pun">(</span><span class="kwd">function</span><span class="pun">(</span><span class="pln">shout</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> %&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;li&gt;</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"meta"</span><span class="tag">&gt;</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;img src="http://www.gravatar.com/avatar/</span><span class="pun">&lt;%=</span><span class="pln"> shout</span><span class="pun">.</span><span class="pln">mailHash</span><span class="pun">()</span><span class="pln"> %&gt;" <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;alt="Gravatar" /&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;p&gt;</span><span class="pun">&lt;%=</span><span class="pln"> shout</span><span class="pun">.</span><span class="pln">name</span><span class="pun">()</span><span class="pln"> %&gt;</span><span class="tag">&lt;/p&gt;</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;/div&gt;</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"shout"</span><span class="tag">&gt;</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;p&gt;</span><span class="pun">&lt;%=</span><span class="pln"> shout</span><span class="pun">.</span><span class="pln">message</span><span class="pun">()</span><span class="pln"> %&gt;</span><span class="tag">&lt;/p&gt;</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;/div&gt;</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;/li&gt;</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="pun">&lt;%</span><span class="pln"> </span><span class="pun">});</span><span class="pln"> %&gt;<br /></span><span class="tag">&lt;/ul&gt;</span><span class="pln"><br /></span></code></pre>

<p>A form for adding new shout is included.  Note how the <code>name</code> attribute is given values prefixed with 'shout'.  This is not necessary in this simple example where we accept data for only one model.  This practice can come handy when accepting data for more than one model within the same form.</p>

<pre><code><span class="tag">&lt;form</span><span class="pln"> </span><span class="atn">action</span><span class="pun">=</span><span class="atv">"/"</span><span class="pln"> </span><span class="atn">method</span><span class="pun">=</span><span class="atv">"post"</span><span class="tag">&gt;</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="tag">&lt;h2&gt;</span><span class="pln">Shout!</span><span class="tag">&lt;/h2&gt;</span><span class="pln"><br /><br />&nbsp; &nbsp; </span><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"fname"</span><span class="tag">&gt;</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;label</span><span class="pln"> </span><span class="atn">for</span><span class="pun">=</span><span class="atv">"name"</span><span class="tag">&gt;&lt;p&gt;</span><span class="pln">Name:</span><span class="tag">&lt;/p&gt;&lt;/label&gt;</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; &lt;input type="text" name="shout.name" value="</span><span class="pun">&lt;%=</span><span class="pln"> shout</span><span class="pun">.</span><span class="pln">name</span><span class="pun">()</span><span class="pln"> %&gt;" size="20" /&gt;<br />&nbsp; &nbsp; </span><span class="tag">&lt;/div&gt;</span><span class="pln"><br /><br />&nbsp; &nbsp; </span><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"femail"</span><span class="tag">&gt;</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;label</span><span class="pln"> </span><span class="atn">for</span><span class="pun">=</span><span class="atv">"email"</span><span class="tag">&gt;&lt;p&gt;</span><span class="pln">Email:</span><span class="tag">&lt;/p&gt;&lt;/label&gt;</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; &lt;input type="text" name="shout.email" value="</span><span class="pun">&lt;%=</span><span class="pln"> shout</span><span class="pun">.</span><span class="pln">email</span><span class="pun">()</span><span class="pln"> %&gt;" size="20" /&gt;<br />&nbsp; &nbsp; </span><span class="tag">&lt;/div&gt;</span><span class="pln"><br /><br />&nbsp; &nbsp; </span><span class="tag">&lt;textarea</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"shout.message"</span><span class="pln"> </span><span class="atn">rows</span><span class="pun">=</span><span class="atv">"5"</span><span class="pln"> </span><span class="atn">cols</span><span class="pun">=</span><span class="atv">"40"</span><span class="tag">&gt;</span><span class="pun">&lt;%=</span><span class="pln"> shout</span><span class="pun">.</span><span class="pln">message</span><span class="pun">()</span><span class="pln"> %&gt;</span><span class="tag">&lt;/textarea&gt;</span><span class="pln"><br /><br />&nbsp; &nbsp; </span><span class="tag">&lt;p&gt;&lt;input</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"submit"</span><span class="pln"> </span><span class="atn">value</span><span class="pun">=</span><span class="atv">"Submit"</span><span class="pln"> </span><span class="tag">/&gt;&lt;/p&gt;</span><span class="pln"><br /></span><span class="tag">&lt;/form&gt;</span><span class="pln"><br /></span></code></pre>

<p>Here is the complete code of the view.</p>

<div class="snippet"><a href="grasshopper-shoutbox/views/index.html" class="code-link">views/index.html</a><pre><code><span class="pun">&lt;%</span><span class="pln"> </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">shout</span><span class="pun">.</span><span class="pln">errors</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> %&gt;<br />&nbsp; &nbsp; </span><span class="tag">&lt;p</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"error"</span><span class="tag">&gt;</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="pun">&lt;%</span><span class="pln">h errors</span><span class="pun">(</span><span class="pln">shout</span><span class="pun">).</span><span class="pln">join</span><span class="pun">(</span><span class="str">'&lt;/p&gt;&lt;p class="error"&gt;'</span><span class="pun">)</span><span class="pln"> %&gt;<br />&nbsp; &nbsp; </span><span class="tag">&lt;/p&gt;</span><span class="pln"><br /></span><span class="pun">&lt;%</span><span class="pln"> </span><span class="pun">}</span><span class="pln"> %&gt;<br /></span><span class="pun">&lt;%</span><span class="pln"> </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">flash</span><span class="pun">[</span><span class="str">'success'</span><span class="pun">])</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> %&gt;<br />&nbsp; &nbsp; </span><span class="tag">&lt;p</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"success"</span><span class="tag">&gt;</span><span class="pun">&lt;%=</span><span class="pln"> flash</span><span class="pun">[</span><span class="str">'success'</span><span class="pun">]</span><span class="pln"> %&gt;</span><span class="tag">&lt;/p&gt;</span><span class="pln"><br /></span><span class="pun">&lt;%</span><span class="pln"> </span><span class="pun">}</span><span class="pln"> %&gt;<br /><br /></span><span class="tag">&lt;ul&gt;</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="pun">&lt;%</span><span class="pln"> shouts</span><span class="pun">.</span><span class="pln">forEach</span><span class="pun">(</span><span class="kwd">function</span><span class="pun">(</span><span class="pln">shout</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> %&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;li&gt;</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"meta"</span><span class="tag">&gt;</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;img src="http://www.gravatar.com/avatar/</span><span class="pun">&lt;%=</span><span class="pln"> shout</span><span class="pun">.</span><span class="pln">mailHash</span><span class="pun">()</span><span class="pln"> %&gt;" <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;alt="Gravatar" /&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;p&gt;</span><span class="pun">&lt;%=</span><span class="pln"> shout</span><span class="pun">.</span><span class="pln">name</span><span class="pun">()</span><span class="pln"> %&gt;</span><span class="tag">&lt;/p&gt;</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;/div&gt;</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"shout"</span><span class="tag">&gt;</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;p&gt;</span><span class="pun">&lt;%=</span><span class="pln"> shout</span><span class="pun">.</span><span class="pln">message</span><span class="pun">()</span><span class="pln"> %&gt;</span><span class="tag">&lt;/p&gt;</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;/div&gt;</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;/li&gt;</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="pun">&lt;%</span><span class="pln"> </span><span class="pun">});</span><span class="pln"> %&gt;<br /></span><span class="tag">&lt;/ul&gt;</span><span class="pln"><br /><br /></span><span class="tag">&lt;form</span><span class="pln"> </span><span class="atn">action</span><span class="pun">=</span><span class="atv">"/"</span><span class="pln"> </span><span class="atn">method</span><span class="pun">=</span><span class="atv">"post"</span><span class="tag">&gt;</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="tag">&lt;h2&gt;</span><span class="pln">Shout!</span><span class="tag">&lt;/h2&gt;</span><span class="pln"><br /><br />&nbsp; &nbsp; </span><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"fname"</span><span class="tag">&gt;</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;label</span><span class="pln"> </span><span class="atn">for</span><span class="pun">=</span><span class="atv">"name"</span><span class="tag">&gt;&lt;p&gt;</span><span class="pln">Name:</span><span class="tag">&lt;/p&gt;&lt;/label&gt;</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; &lt;input type="text" name="shout.name" value="</span><span class="pun">&lt;%=</span><span class="pln"> shout</span><span class="pun">.</span><span class="pln">name</span><span class="pun">()</span><span class="pln"> %&gt;" size="20" /&gt;<br />&nbsp; &nbsp; </span><span class="tag">&lt;/div&gt;</span><span class="pln"><br /><br />&nbsp; &nbsp; </span><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"femail"</span><span class="tag">&gt;</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;label</span><span class="pln"> </span><span class="atn">for</span><span class="pun">=</span><span class="atv">"email"</span><span class="tag">&gt;&lt;p&gt;</span><span class="pln">Email:</span><span class="tag">&lt;/p&gt;&lt;/label&gt;</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; &lt;input type="text" name="shout.email" value="</span><span class="pun">&lt;%=</span><span class="pln"> shout</span><span class="pun">.</span><span class="pln">email</span><span class="pun">()</span><span class="pln"> %&gt;" size="20" /&gt;<br />&nbsp; &nbsp; </span><span class="tag">&lt;/div&gt;</span><span class="pln"><br /><br />&nbsp; &nbsp; </span><span class="tag">&lt;textarea</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"shout.message"</span><span class="pln"> </span><span class="atn">rows</span><span class="pun">=</span><span class="atv">"5"</span><span class="pln"> </span><span class="atn">cols</span><span class="pun">=</span><span class="atv">"40"</span><span class="tag">&gt;</span><span class="pun">&lt;%=</span><span class="pln"> shout</span><span class="pun">.</span><span class="pln">message</span><span class="pun">()</span><span class="pln"> %&gt;</span><span class="tag">&lt;/textarea&gt;</span><span class="pln"><br /><br />&nbsp; &nbsp; </span><span class="tag">&lt;p&gt;&lt;input</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"submit"</span><span class="pln"> </span><span class="atn">value</span><span class="pun">=</span><span class="atv">"Submit"</span><span class="pln"> </span><span class="tag">/&gt;&lt;/p&gt;</span><span class="pln"><br /></span><span class="tag">&lt;/form&gt;</span></code></pre></div>

<h2>Making it all work</h2>

<p>Download the <a href="grasshopper-shoutbox/design.zip">images and CSS</a> and extract them into your <code>shoutbox</code> directory.</p>

<p>Create a file named <code>boot.js</code> and put the following content in it.</p>

<div class="snippet"><a href="grasshopper-shoutbox/boot.js" class="code-link">boot.js</a><pre><code><span class="kwd">var</span><span class="pln"> gh </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'grasshopper'</span><span class="pun">);</span><span class="pln"><br /><br />gh</span><span class="pun">.</span><span class="pln">configure</span><span class="pun">({</span><span class="pln"><br />&nbsp; &nbsp; layout</span><span class="pun">:</span><span class="pln"> </span><span class="str">'views/layout'</span><span class="pun">,</span><span class="pln"><br />&nbsp; &nbsp; viewsDir</span><span class="pun">:</span><span class="pln"> </span><span class="str">'views'</span><span class="pln"><br /></span><span class="pun">});</span><span class="pln"><br /><br /></span><span class="kwd">require</span><span class="pun">(</span><span class="str">'./app/controller'</span><span class="pun">);</span><span class="pln"><br /><br />gh</span><span class="pun">.</span><span class="pln">serve</span><span class="pun">(</span><span class="lit">8080</span><span class="pun">);</span></code></pre></div>

<p>We're configuring Grashopper to use <code>views/layout</code> (extension not required) as layout file for the application and ask it to find all view templates within the <code>views</code> directory.  Start the application with <code>node boot.js</code> and point your browser to <a href="index.html">http://localhost:8080</a>.</p>

<h2>Happy Shouting!</h2>

<p>There we have a nice looking shoutbox which takes care of validations and thanks users for shouting to theirs hearts content.  :)  Have a look at the Grasshopper <a href="http://github.com/tuxychandru/grasshopper#readme">README</a> and <a href="http://github.com/tuxychandru/grasshopper#readme">Wiki</a> for tutorials and examples of how various REST-ful web applications and services can be built on Grasshopper.</p><hr style="clear:both" /><div class="body" id="disqus_thread"></div>
<script type="text/javascript">
//<![CDATA[
var disqus_url = "http://howtonode.org/grasshopper-shoutbox";
//]]>
</script>
<script src="http://disqus.com/forums/howtonodeorg/embed.js" type="text/javascript"></script><a href="http://disqus.com/forums/howtonodeorg/?url=ref" class="view-thread">View the discussion thread.</a><a href="http://disqus.com/" class="dsq-brlink">blog comments powered by<span class="logo-disqus">Disqus</span></a>
<script type="text/javascript">
//<![CDATA[
(function() {
  var links = document.getElementsByTagName('a');
  var query = '?';
  for(var i = 0; i < links.length; i++) {
    if(links[i].href.indexOf('#disqus_thread') >= 0) {
      query += 'url' + i + '=' + encodeURIComponent(links[i].href) + '&amp;';
    }
  }
  document.write('<script charset="utf-8" type="text/javascript" src="//disqus.com/forums/howtonodeorg/get_num_replies.js' + query + '"></' + 'script>');
})();


//]]>
</script>
</div></div><div id="sidebar"><div class="aside author"><h4>About the Author</h4><img src="https://www.gravatar.com/avatar/e8ae4e7eded8cd37805b4b31cc1f1c53?r=pg&amp;s=200.jpg&amp;d=identicon" class="headshot" /><dl><dt>Name:</dt><dd>Chandra Sekar S</dd></dl><dl><dt>Github:</dt><dd><a href="https://github.com/tuxychandru">tuxychandru</a></dd></dl><dl><dt>Twitter:</dt><dd><a href="https://twitter.com/tuxychandru">tuxychandru</a></dd></dl><dl><dt>Location:</dt><dd>Bangalore, IN</dd></dl></div><div class="aside"><h4>About this Article</h4><a href="http://twitter.com/share" data-count="horizontal" data-via="creationix" class="twitter-share-button">Tweet</a><script src="http://platform.twitter.com/widgets.js"></script><dl title="Thu Aug 05 2010 19:03:56 GMT+0530 (IST)"><dt>Date Released:</dt><dd>Thursday, August  5, 2010</dd></dl><dl><dt>Node Version:</dt><dd><a href="http://github.com/joyent/node/tree/v0.1.103">node v0.1.103</a></dd></dl><dl><dt>Code Samples:</dt><dd><ul><li><a href="grasshopper-shoutbox/createdb.js">createdb.js</a></li><li><a href="grasshopper-shoutbox/app/model.js">app/model.js</a></li><li><a href="grasshopper-shoutbox/app/shoutRepository.js">app/shoutRepository.js</a></li><li><a href="grasshopper-shoutbox/app/controller.js">app/controller.js</a></li><li><a href="grasshopper-shoutbox/views/layout.html">views/layout.html</a></li><li><a href="grasshopper-shoutbox/views/index.html">views/index.html</a></li><li><a href="grasshopper-shoutbox/boot.js">boot.js</a></li></ul></dd></dl><dl><dt>Revisions:</dt><dd><ul></ul></dd></dl></div><div class="bubble"><h3>About HowToNode.org</h3>

<p>HowToNode.org is a community supported blog created by <a href="http://creationix.com/">Tim Caswell</a>. The purpose of the blog is to teach how to do various tasks in <a href="http://nodejs.org/">node.js</a> as well as teach fundamental concepts that are needed to write effective code.</p>

<p>This site is powered by <a href="http://github.com/creationix/wheat">Wheat</a>, a git based blogging engine written in <a href="http://nodejs.org/">node.JS</a>.</p>

<p>The content for this site is stored in a <a href="http://github.com/creationix/howtonode.org">git repository</a> that anyone can fork, write an article, and send a pull request. If your article passes the quality standards it will be published and help support the greater node community.</p></div></div><div id="footer"><p>&copy; 2011-2014 Tim Caswell under the MIT license.</p><p>Content and articles are copyrighted to the individual authors. Design by&nbsp;<a href="https://bengourley.co.uk/">Ben Gourley</a>. All code snippets used in the examples are in the public domain.</p><p>Wheat v2 running on node.js v16.4.2</p></div></div>
<script type="text/javascript">
//<![CDATA[
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
//]]>
</script>

<script type="text/javascript">
//<![CDATA[
try {
var pageTracker = _gat._getTracker("UA-12824411-1");
pageTracker._trackPageview();
} catch(err) {}
//]]>
</script>
</body>
<!-- Mirrored from localhost:8080/grasshopper-shoutbox by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 13 Jul 2021 13:58:48 GMT -->
</html>