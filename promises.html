<!DOCTYPE html>
<html lang="en">
<!-- Mirrored from localhost:8080/promises by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 13 Jul 2021 13:57:07 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head><meta charset="utf-8" /><title>Asynchronous Control Flow with Promises - How To Node - NodeJS</title><meta name="description" content="Learn the zen of coding in NodeJS." /><meta name="viewport" content="width=device-width" /><link href="style.css" rel="stylesheet" /><link href="print.css" rel="stylesheet" media="print" /><link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="feed.xml" /><link href="favicon.ico" rel="icon" type="image/x-icon" /></head><body><div id="container"><div id="header"><a href="index.html"><img src="logo.png" alt="How to Node" class="logo" /><div class="tagline">The zen of coding in node.js</div></a></div><div id="main"><div class="article"><h1><a href="promises.html">Asynchronous Control Flow with Promises</a></h1><p class="old-node-warning">HEADS UP! This article was written for an older version of node.&nbsp;More up-to-date information may be available elsewhere.</p><p>A Promise is an object that represents the result of an asynchronous function call. Promises are also
called futures and deferreds in some communities.</p>

<h2>Goal of this Article</h2>

<p>The goal of this article is to introduce CommonJS promises as they exist in NodeJS user-land.
With jQuery popularizing a variant of CommonJS promises for AJAX operations, promises will likely gain
a broader user-base in the browser and on the server.</p>

<h2>Brief History of Promises in Node</h2>

<p>Promises based on EventEmitters were originally a part of Node.  They looked like this:</p>

<pre><code><span class="kwd">var</span><span class="pln"> promise </span><span class="pun">=</span><span class="pln"> fs</span><span class="pun">.</span><span class="pln">stat</span><span class="pun">(</span><span class="str">"foo"</span><span class="pun">);</span><span class="pln"><br />promise</span><span class="pun">.</span><span class="pln">addListener</span><span class="pun">(</span><span class="str">"success"</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> </span><span class="pun">(</span><span class="pln">value</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="com">// ok</span><span class="pln"><br /></span><span class="pun">})</span><span class="pln"><br />promise</span><span class="pun">.</span><span class="pln">addListener</span><span class="pun">(</span><span class="str">"error"</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> </span><span class="pun">(</span><span class="pln">error</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="com">// error</span><span class="pln"><br /></span><span class="pun">});</span><span class="pln"><br /></span></code></pre>

<p>The style required more allocations than necessary.
There were also political issues because these "promises" did not fulfill all of
the contracts that advocates for promises insisted they must.  Between
aesthetics, politics, and reductionism, Ryan removed promises in the v0.2
era and settled on the present callback style, leaving promises as an
exercise for user-land.</p>

<pre><code><span class="pln">fs</span><span class="pun">.</span><span class="pln">stat</span><span class="pun">(</span><span class="str">"foo"</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> </span><span class="pun">(</span><span class="pln">error</span><span class="pun">,</span><span class="pln"> value</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">error</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// error</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// ok</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"><br /></span><span class="pun">});</span><span class="pln"><br /></span></code></pre>

<h2>Promise Terminology</h2>

<ul>
<li>Fulfillment: When a successful promise is fulfilled, all of the pending callbacks are called with the value. If more callbacks are registered in the future, they will be called with the same value. Fulfilment is the asynchronous analog for returning a value.</li>
<li>Rejection: When a promise cannot be fulfilled, a promise is 'rejected' which invokes the errbacks that are waiting and remembers the error that was rejected for future errbacks that are attached. Rejection is the asynchronous analog for throwing an exception.</li>
<li>Resolution: A promise is resolved when it makes progress toward fulfillment or rejection.  A promise can only be resolved once, and it can be resolved with a promise instead of a fulfillment or rejection.</li>
<li>Callback: A function executed if a a promise is fulfilled with a value.</li>
<li>Errback: A function executed if a promise is rejected, with an exception.</li>
<li>Progressback: A function executed to show that progress has been made toward resolution of a promise.</li>
</ul>

<h2>Promise Libraries</h2>

<h3>Server Side</h3>

<p>There are two primary implementations of CommonJS promises for Node:</p>

<h4><a href="https://github.com/kriskowal/q">Q library</a> by Kris Kowal.</h4>

<p>Install with NPM: <code>npm install q</code></p>

<pre><code><span class="kwd">var</span><span class="pln"> q </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'q'</span><span class="pun">);</span><span class="pln"><br /></span></code></pre>

<h4><a href="https://github.com/kriszyp/promised-io">Promised-IO</a> by Kris Zyp.</h4>

<p>Install with NPM: <code>npm install promised-io</code></p>

<pre><code><span class="kwd">var</span><span class="pln"> q </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'promised-io/lib/promise'</span><span class="pun">);</span><span class="pln"> </span><span class="com">// &lt;=v2.3</span><span class="pln"><br /><br /></span><span class="kwd">var</span><span class="pln"> q </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'promised-io/promise'</span><span class="pun">);</span><span class="pln"> </span><span class="com">// &gt;=v2.4</span><span class="pln"><br /></span></code></pre>

<p>They are compatible and even capable of consuming each others promises, so which you use
is a matter of preference. These libraries do different helper functions outside 
of the basic functions necessary to consume and create promises.</p>

<p>The rest of the server-side examples will assume that a <code>q</code> variable referencing
a promise module is in scope.</p>

<h3>Client Side</h3>

<p>jQuery implemented Promises in version 1.5.</p>

<pre><code><span class="pln">$</span><span class="pun">.</span><span class="kwd">when</span><span class="pun">(</span><span class="pln">$</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(...))</span><span class="pln"><br /></span><span class="pun">.</span><span class="kwd">then</span><span class="pun">(</span><span class="kwd">function</span><span class="pun">(</span><span class="pln">value</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="str">'success!'</span><span class="pun">)</span><span class="pln"><br /></span><span class="pun">},</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">error</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="str">'rejection'</span><span class="pun">);</span><span class="pln"><br /></span><span class="pun">});</span><span class="pln"><br /></span></code></pre>

<h2>The Promise Contract</h2>

<h3>There is <em>one</em> Resolution or Rejection</h3>

<p>A promise is resolved one time. It will never be fulfilled if it has been rejected
or rejected if it has been fulfilled.</p>

<h3>Listeners are executed <em>one</em> time</h3>

<p>An individual callback or errback will be executed once and only once. This follows
from the first rule of the contract.</p>

<h3>Promises remember their state</h3>

<p>A promise that is resolved with a value remembers the fulfillment. If a
callback is attached in the future to this promise, it will be executed
with the previously resolved value. The same is true of errbacks. If a
promise is rejected and an errback is attached after the rejection, it will
be executed with the rejected value.  Promises behave the same way regardless
of whether they are already resolved or resolved in the future.</p>

<h2>Thenables</h2>

<p>CommonJS promises are sometimes referred to as thenables. This term derives from the <code>then</code> method available on a promise.
The <code>then</code> method is the gateway to attaching callbacks, errbacks, and progressbacks.</p>

<pre><code><span class="pln">myPromise</span><span class="pun">.</span><span class="kwd">then</span><span class="pun">(</span><span class="kwd">function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; </span><span class="com">// callback, executed on successful promise resolution</span><span class="pln"><br /></span><span class="pun">},</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; </span><span class="com">// errback, executed on rejection</span><span class="pln"><br /></span><span class="pun">},</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; </span><span class="com">// progressback, executed if the promise has progress to report</span><span class="pln"><br /></span><span class="pun">});</span><span class="pln"><br /></span></code></pre>

<h2>When</h2>

<p>The <code>when</code> function is a helper to attach listeners to an object that you are
not sure is a promise. This is useful because it is often helpful for methods
to be able to return a promise or a direct value. If a direct value is returned,it will not
have a <code>then</code> method.  Also, if the promise does not implement <code>then</code> properly,
the <code>when</code> function makes sure that it behaves properly by ensuring your callbacks
are called in separate events and never more than once.</p>

<pre><code><span class="kwd">when</span><span class="pun">(</span><span class="pln">maybePromise</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; </span><span class="com">// callback, executed on successful promise resolution or if maybePromise is not a promise but a value</span><span class="pln"><br /></span><span class="pun">},</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; </span><span class="com">// errback, executed on rejection</span><span class="pln"><br /></span><span class="pun">},</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; </span><span class="com">// progressback, executed if the promise has progress to report</span><span class="pln"><br /></span><span class="pun">});</span><span class="pln"><br /></span></code></pre>

<h2>Bubbling</h2>

<p>The value returned by a callback is bubbled up the chain of promises. The same is true of rejections.
This allows for rejections to be handled at a higher level than the function that called the promise-returning
function that is rejected. This also allows promise-based APIs to compose responses for rejections and successes
by changing the value or error as it is bubbled.</p>

<pre><code><span class="kwd">function</span><span class="pln"> doSomethingAsync</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; </span><span class="kwd">return</span><span class="pln"> asyncHelper</span><span class="pun">().</span><span class="kwd">then</span><span class="pun">(</span><span class="kwd">function</span><span class="pun">(</span><span class="pln">val</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="com">// do some extra processing on val</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="kwd">return</span><span class="pln"> val</span><span class="pun">;</span><span class="pln"> </span><span class="pun">&lt;--</span><span class="pln"> becomes the resolution of the promise returned </span><span class="kwd">by</span><span class="pln"> doSomethingAsync<br />&nbsp; </span><span class="pun">});</span><span class="pln"><br /></span><span class="pun">}</span><span class="pln"><br /><br />doSomethingAsync</span><span class="pun">().</span><span class="kwd">then</span><span class="pun">(</span><span class="kwd">function</span><span class="pun">(</span><span class="pln">val</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="str">'resolved'</span><span class="pun">,</span><span class="pln"> val</span><span class="pun">);</span><span class="pln"><br /></span><span class="pun">},</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">err</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; </span><span class="com">// Will receive rejections from doSomethingAsync or bubbled from asyncHelper</span><span class="pln"><br />&nbsp; console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="str">'error'</span><span class="pun">,</span><span class="pln"> err</span><span class="pun">);</span><span class="pln"><br /></span><span class="pun">});</span><span class="pln"><br /></span></code></pre>

<h2>Creating Promises using the Deferred helper</h2>

<p>A Deferred is an object that helps create and manipulate promises. A Deferred
has a <code>promise</code> property that references the promise that it manages. It also
has <code>resolve</code> and <code>reject</code> methods that are responsible for resolving / rejecting
the promise.</p>

<p><code>resolve</code> is a function that may be passed a value or a promise.
If it is passed a value, the promise is fulfilled.
If it is passed a promise, that promise’s resolution will eventually
be forwarded to this one.</p>

<p>Both Kris Kowal's Q and Kris Zyp's Promised-IO libraries enforce the rule
that a promise can only be resolved once.  Kris Kowal’s Q library allows multiple
agents to “race” to be the first to resolve the promise. Kris Zyp’s Promised-IO
throws an exception if you attempt to resolve a promise a second time.</p>

<p>Reject is a function that accepts a reason for rejection. The rejection may be of any type but
is commonly a string. The Deferred rejects its promise with the rejection reason.</p>

<pre><code><span class="kwd">function</span><span class="pln"> doSomethingAsync</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; </span><span class="kwd">var</span><span class="pln"> deferred </span><span class="pun">=</span><span class="pln"> q</span><span class="pun">.</span><span class="pln">defer</span><span class="pun">();</span><span class="pln"><br />&nbsp; setTimeout</span><span class="pun">(</span><span class="kwd">function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; deferred</span><span class="pun">.</span><span class="pln">resolve</span><span class="pun">(</span><span class="str">'hello world'</span><span class="pun">);</span><span class="pln"><br />&nbsp; </span><span class="pun">},</span><span class="pln"> </span><span class="lit">500</span><span class="pun">);</span><span class="pln"><br /><br />&nbsp; </span><span class="kwd">return</span><span class="pln"> deferred</span><span class="pun">.</span><span class="pln">promise</span><span class="pun">;</span><span class="pln"><br /></span><span class="pun">}</span><span class="pln"><br /><br />doSomethingAsync</span><span class="pun">().</span><span class="kwd">then</span><span class="pun">(</span><span class="kwd">function</span><span class="pun">(</span><span class="pln">val</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="str">'Promise Resolved!'</span><span class="pun">,</span><span class="pln"> val</span><span class="pun">);</span><span class="pln"><br /></span><span class="pun">});</span><span class="pln"><br /></span></code></pre>

<h2>Wrapping a function that takes a Node-style callback</h2>

<p>The majority of functions that take Node-style callbacks are suitable for wrapping in a Promise.
Any Node-style callback function that only calls its callback one time may be wrapped.</p>

<p>The following function is taken from <a href="https://github.com/nrstott/bogart">Bogart</a>.</p>

<pre><code><span class="kwd">function</span><span class="pln"> promisify</span><span class="pun">(</span><span class="pln">nodeAsyncFn</span><span class="pun">,</span><span class="pln"> context</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="kwd">var</span><span class="pln"> defer </span><span class="pun">=</span><span class="pln"> q</span><span class="pun">.</span><span class="pln">defer</span><span class="pun">()</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; </span><span class="pun">,</span><span class="pln"> args </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Array</span><span class="pun">.</span><span class="pln">prototype</span><span class="pun">.</span><span class="pln">slice</span><span class="pun">.</span><span class="pln">call</span><span class="pun">(</span><span class="pln">arguments</span><span class="pun">);</span><span class="pln"><br /><br />&nbsp; &nbsp; args</span><span class="pun">.</span><span class="pln">push</span><span class="pun">(</span><span class="kwd">function</span><span class="pun">(</span><span class="pln">err</span><span class="pun">,</span><span class="pln"> val</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">err </span><span class="pun">!==</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">return</span><span class="pln"> defer</span><span class="pun">.</span><span class="pln">reject</span><span class="pun">(</span><span class="pln">err</span><span class="pun">);</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"><br /><br />&nbsp; &nbsp; &nbsp; </span><span class="kwd">return</span><span class="pln"> defer</span><span class="pun">.</span><span class="pln">resolve</span><span class="pun">(</span><span class="pln">val</span><span class="pun">);</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="pun">});</span><span class="pln"><br /><br />&nbsp; &nbsp; nodeAsyncFn</span><span class="pun">.</span><span class="pln">apply</span><span class="pun">(</span><span class="pln">context </span><span class="pun">||</span><span class="pln"> </span><span class="pun">{},</span><span class="pln"> args</span><span class="pun">);</span><span class="pln"><br /><br />&nbsp; &nbsp; </span><span class="kwd">return</span><span class="pln"> defer</span><span class="pun">.</span><span class="pln">promise</span><span class="pun">;</span><span class="pln"><br />&nbsp; </span><span class="pun">};</span><span class="pln"><br /></span><span class="pun">};</span><span class="pln"><br /></span></code></pre>

<p>This function can be used with node functions like <code>fs.readFile</code>.</p>

<pre><code><span class="kwd">var</span><span class="pln"> readFile </span><span class="pun">=</span><span class="pln"> promisify</span><span class="pun">(</span><span class="pln">fs</span><span class="pun">.</span><span class="pln">readFile</span><span class="pun">);</span><span class="pln"><br />readFile</span><span class="pun">(</span><span class="str">'test.txt'</span><span class="pun">).</span><span class="kwd">then</span><span class="pun">(</span><span class="kwd">function</span><span class="pun">(</span><span class="pln">data</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="pln">data</span><span class="pun">);</span><span class="pln"><br /></span><span class="pun">});</span><span class="pln"><br /></span></code></pre>

<p>Both Q and PromisedIO provide utilities for wrapping or calling Node-style
functions.</p>

<p>With Kris Zyp’s PromisedIO:</p>

<pre><code><span class="kwd">var</span><span class="pln"> readFile </span><span class="pun">=</span><span class="pln"> q</span><span class="pun">.</span><span class="pln">convertNodeAsyncFunction</span><span class="pun">(</span><span class="pln">fs</span><span class="pun">.</span><span class="pln">readFile</span><span class="pun">);</span><span class="pln"><br />readFile</span><span class="pun">(</span><span class="str">'test.txt'</span><span class="pun">)</span><span class="pln"><br /></span><span class="pun">.</span><span class="kwd">then</span><span class="pun">(</span><span class="kwd">function</span><span class="pln"> </span><span class="pun">(</span><span class="pln">data</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">});</span><span class="pln"><br /><br /></span><span class="com">// or</span><span class="pln"><br /><br />q</span><span class="pun">.</span><span class="pln">execute</span><span class="pun">(</span><span class="pln">fs</span><span class="pun">.</span><span class="pln">readFile</span><span class="pun">,</span><span class="pln"> </span><span class="str">'test.txt'</span><span class="pun">)</span><span class="pln"><br /></span><span class="pun">.</span><span class="kwd">then</span><span class="pun">(</span><span class="kwd">function</span><span class="pln"> </span><span class="pun">(</span><span class="pln">data</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">});</span><span class="pln"><br /></span></code></pre>

<p>With Kris Kowal’s Q:</p>

<pre><code><span class="kwd">var</span><span class="pln"> readFile </span><span class="pun">=</span><span class="pln"> q</span><span class="pun">.</span><span class="pln">node</span><span class="pun">(</span><span class="pln">fs</span><span class="pun">.</span><span class="pln">readFile</span><span class="pun">);</span><span class="pln"><br />readFile</span><span class="pun">(</span><span class="str">'test.txt'</span><span class="pun">)</span><span class="pln"><br /></span><span class="pun">.</span><span class="kwd">then</span><span class="pun">(</span><span class="kwd">function</span><span class="pln"> </span><span class="pun">(</span><span class="pln">data</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">});</span><span class="pln"><br /><br /></span><span class="com">// or</span><span class="pln"><br /><br />q</span><span class="pun">.</span><span class="pln">ncall</span><span class="pun">(</span><span class="pln">fs</span><span class="pun">.</span><span class="pln">readFile</span><span class="pun">,</span><span class="pln"> fs</span><span class="pun">,</span><span class="pln"> </span><span class="str">'test.txt'</span><span class="pun">)</span><span class="pln"><br /></span><span class="pun">.</span><span class="kwd">then</span><span class="pun">(</span><span class="kwd">function</span><span class="pln"> </span><span class="pun">(</span><span class="pln">data</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">});</span><span class="pln"><br /><br /></span><span class="com">// or</span><span class="pln"><br /><br /></span><span class="kwd">var</span><span class="pln"> deferred </span><span class="pun">=</span><span class="pln"> q</span><span class="pun">.</span><span class="pln">defer</span><span class="pun">();</span><span class="pln"><br />fs</span><span class="pun">.</span><span class="pln">readFile</span><span class="pun">(</span><span class="str">'test.txt'</span><span class="pun">,</span><span class="pln"> deferred</span><span class="pun">.</span><span class="pln">node</span><span class="pun">());</span><span class="pln"><br /></span><span class="kwd">return</span><span class="pln"> deferred</span><span class="pun">.</span><span class="pln">promise</span><span class="pun">;</span><span class="pln"><br /></span></code></pre>

<h2>Conclusions</h2>

<p>Promises are a valuable tool for managing asynchronous control flow. With jQuery adopting
Promises, more JavaScript programmers will see them as the preferred method of managing
asynchronous state. If you have any questions, please leave them in the comments section.</p><hr style="clear:both" /><div class="body" id="disqus_thread"></div>
<script type="text/javascript">
//<![CDATA[
var disqus_url = "http://howtonode.org/promises";
//]]>
</script>
<script src="http://disqus.com/forums/howtonodeorg/embed.js" type="text/javascript"></script><a href="http://disqus.com/forums/howtonodeorg/?url=ref" class="view-thread">View the discussion thread.</a><a href="http://disqus.com/" class="dsq-brlink">blog comments powered by<span class="logo-disqus">Disqus</span></a>
<script type="text/javascript">
//<![CDATA[
(function() {
  var links = document.getElementsByTagName('a');
  var query = '?';
  for(var i = 0; i < links.length; i++) {
    if(links[i].href.indexOf('#disqus_thread') >= 0) {
      query += 'url' + i + '=' + encodeURIComponent(links[i].href) + '&amp;';
    }
  }
  document.write('<script charset="utf-8" type="text/javascript" src="//disqus.com/forums/howtonodeorg/get_num_replies.js' + query + '"></' + 'script>');
})();


//]]>
</script>
</div></div><div id="sidebar"><div class="aside author"><h4>About the Author</h4><img src="https://www.gravatar.com/avatar/67b36dc8be45af469b4538f86bee144f?r=pg&amp;s=200.jpg&amp;d=identicon" class="headshot" /><dl><dt>Name:</dt><dd>Nathan Stott</dd></dl><dl><dt>Github:</dt><dd><a href="https://github.com/nrstott">nrstott</a></dd></dl><dl><dt>Twitter:</dt><dd><a href="https://twitter.com/nathan_stott">nathan_stott</a></dd></dl><dl><dt>Location:</dt><dd>Birmingham, AL</dd></dl><dl><dt>Links:</dt><dd><a href="http://whiteboard-it.com/">Homepage</a></dd></dl></div><div class="aside"><h4>About this Article</h4><a href="http://twitter.com/share" data-count="horizontal" data-via="creationix" class="twitter-share-button">Tweet</a><script src="http://platform.twitter.com/widgets.js"></script><dl title="Tue Dec 20 2011 08:00:00 GMT-0700 (PDT)"><dt>Date Released:</dt><dd>Tuesday, December 20, 2011</dd></dl><dl><dt>Node Version:</dt><dd><a href="http://github.com/joyent/node/tree/v0.6.5">node v0.6.5</a></dd></dl><dl><dt>Revisions:</dt><dd><ul></ul></dd></dl></div><div class="bubble"><h3>About HowToNode.org</h3>

<p>HowToNode.org is a community supported blog created by <a href="http://creationix.com/">Tim Caswell</a>. The purpose of the blog is to teach how to do various tasks in <a href="http://nodejs.org/">node.js</a> as well as teach fundamental concepts that are needed to write effective code.</p>

<p>This site is powered by <a href="http://github.com/creationix/wheat">Wheat</a>, a git based blogging engine written in <a href="http://nodejs.org/">node.JS</a>.</p>

<p>The content for this site is stored in a <a href="http://github.com/creationix/howtonode.org">git repository</a> that anyone can fork, write an article, and send a pull request. If your article passes the quality standards it will be published and help support the greater node community.</p></div></div><div id="footer"><p>&copy; 2011-2014 Tim Caswell under the MIT license.</p><p>Content and articles are copyrighted to the individual authors. Design by&nbsp;<a href="https://bengourley.co.uk/">Ben Gourley</a>. All code snippets used in the examples are in the public domain.</p><p>Wheat v2 running on node.js v16.4.2</p></div></div>
<script type="text/javascript">
//<![CDATA[
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
//]]>
</script>

<script type="text/javascript">
//<![CDATA[
try {
var pageTracker = _gat._getTracker("UA-12824411-1");
pageTracker._trackPageview();
} catch(err) {}
//]]>
</script>
</body>
<!-- Mirrored from localhost:8080/promises by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 13 Jul 2021 13:57:07 GMT -->
</html>