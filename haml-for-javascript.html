<!DOCTYPE html>
<html lang="en">
<!-- Mirrored from localhost:8080/haml-for-javascript by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 13 Jul 2021 14:00:11 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head><meta charset="utf-8" /><title>Using HAML templates in JavaScript - How To Node - NodeJS</title><meta name="description" content="Learn the zen of coding in NodeJS." /><meta name="viewport" content="width=device-width" /><link href="style.css" rel="stylesheet" /><link href="print.css" rel="stylesheet" media="print" /><link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="feed.xml" /><link href="favicon.ico" rel="icon" type="image/x-icon" /></head><body><div id="container"><div id="header"><a href="index.html"><img src="logo.png" alt="How to Node" class="logo" /><div class="tagline">The zen of coding in node.js</div></a></div><div id="main"><div class="article"><h1><a href="haml-for-javascript.html">Using HAML templates in JavaScript</a></h1><p class="old-node-warning">HEADS UP! This article was written for an older version of node.&nbsp;More up-to-date information may be available elsewhere.</p><p>One of my favorite libraries when I was doing <a href="http://ruby-lang.org/">ruby</a> development was the HTML templating language <a href="http://haml-lang.com/">HAML</a>.  For those of you who haven't yet been enlightened, it's an alternate syntax for XML that results in a <strong>lot</strong> less code to write the same thing.</p>

<p>When I switched to primarily JavaScript, I missed HAML so much I wrote two ports of it.  One is called <a href="http://github.com/creationix/jquery-haml">jquery-haml</a>.  It's a dom-building library with some really advanced DOM integration tricks.  The other is <a href="http://github.com/creationix/haml-js">haml-js</a>.  It's a text-to-text compiler that translates HAML code to HTML, perfect for node based websites.</p>

<p><strong>UPDATE</strong> This article was left as is mostly, current development resides in <a href="http://jade-lang.com/">jade</a> and <a href="http://github.com/creationix/grain">grain</a>.</p>

<h2>Using <code>haml-js</code> in a node website</h2>

<p>Using <a href="http://github.com/creationix/haml-js">haml-js</a> is pretty straightforward.  First, you install <code>haml-js</code> as a library for use in node.  The full docs are <a href="http://nodejs.org/api.html#_modules">here</a>, but I'll show how I set up my node libraries.</p>

<h3>Installing <code>haml-js</code> in node</h3>

<p>There wasn't a standard package manager for node when this was written, but it's not hard to install a package once you've done it a time or two.  I like to use git for all GitHub based libraries so that I can update any library by issuing a pull command.</p>

<pre><code><span class="pln">tim@TimBook</span><span class="pun">:~</span><span class="pln">$ mkdir </span><span class="typ">Code</span><span class="pln"><br />tim@TimBook</span><span class="pun">:~</span><span class="pln">$ cd </span><span class="typ">Code</span><span class="pun">/</span><span class="pln"><br />tim@TimBook</span><span class="pun">:~/</span><span class="typ">Code$</span><span class="pln"> git clone git</span><span class="pun">:</span><span class="com">//github.com/creationix/haml-js.git</span><span class="pln"><br /></span><span class="typ">Initialized</span><span class="pln"> empty </span><span class="typ">Git</span><span class="pln"> repository </span><span class="kwd">in</span><span class="pln"> </span><span class="pun">/</span><span class="typ">Users</span><span class="pun">/</span><span class="pln">tim</span><span class="pun">/</span><span class="typ">Code</span><span class="pun">/</span><span class="pln">haml</span><span class="pun">-</span><span class="pln">js</span><span class="pun">/.</span><span class="pln">git</span><span class="pun">/</span><span class="pln"><br />remote</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Counting</span><span class="pln"> objects</span><span class="pun">:</span><span class="pln"> </span><span class="lit">311</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">done</span><span class="pun">.</span><span class="pln"><br />remote</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Compressing</span><span class="pln"> objects</span><span class="pun">:</span><span class="pln"> </span><span class="lit">100</span><span class="pun">%</span><span class="pln"> </span><span class="pun">(</span><span class="lit">278</span><span class="pun">/</span><span class="lit">278</span><span class="pun">),</span><span class="pln"> </span><span class="kwd">done</span><span class="pun">.</span><span class="pln"><br />remote</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Total</span><span class="pln"> </span><span class="lit">311</span><span class="pln"> </span><span class="pun">(</span><span class="pln">delta </span><span class="lit">161</span><span class="pun">),</span><span class="pln"> reused </span><span class="lit">0</span><span class="pln"> </span><span class="pun">(</span><span class="pln">delta </span><span class="lit">0</span><span class="pun">)</span><span class="pln"><br /></span><span class="typ">Receiving</span><span class="pln"> objects</span><span class="pun">:</span><span class="pln"> </span><span class="lit">100</span><span class="pun">%</span><span class="pln"> </span><span class="pun">(</span><span class="lit">311</span><span class="pun">/</span><span class="lit">311</span><span class="pun">),</span><span class="pln"> </span><span class="lit">47.73</span><span class="pln"> </span><span class="typ">KiB</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">done</span><span class="pun">.</span><span class="pln"><br /></span><span class="typ">Resolving</span><span class="pln"> deltas</span><span class="pun">:</span><span class="pln"> </span><span class="lit">100</span><span class="pun">%</span><span class="pln"> </span><span class="pun">(</span><span class="lit">161</span><span class="pun">/</span><span class="lit">161</span><span class="pun">),</span><span class="pln"> </span><span class="kwd">done</span><span class="pun">.</span><span class="pln"><br />tim@TimBook</span><span class="pun">:~</span><span class="pln">$ mkdir </span><span class="pun">~</span><span class="str">/.node_libraries<br />tim@TimBook:~$ cd ~/</span><span class="pun">.</span><span class="pln">node_libraries<br />tim@TimBook</span><span class="pun">:~/.</span><span class="pln">node_libraries$ ln </span><span class="pun">-</span><span class="pln">s </span><span class="pun">~</span><span class="str">/Code/</span><span class="pln">haml</span><span class="pun">-</span><span class="pln">js</span><span class="pun">/</span><span class="pln">lib</span><span class="com">/* ./<br /></span></code></pre>

<p>Basically I made a folder for code clones, another one for node libraries, and linked the two up so node can find the code.</p>

<h2>Checking the install</h2>

<p>To test if it's installed, open a <code>node</code> terminal and try to <code>require</code> it. </p>

<pre><code><span class="pln">tim@TimBook</span><span class="pun">:~</span><span class="pln">$ node<br /></span><span class="typ">Type</span><span class="pln"> </span><span class="str">'.help'</span><span class="pln"> </span><span class="kwd">for</span><span class="pln"> options</span><span class="pun">.</span><span class="pln"><br />node</span><span class="pun">&gt;</span><span class="pln"> </span><span class="kwd">var</span><span class="pln"> </span><span class="typ">Haml</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'haml'</span><span class="pun">);</span><span class="pln"><br />node</span><span class="pun">&gt;</span><span class="pln"> </span><span class="typ">Haml</span><span class="pun">.</span><span class="pln">render</span><span class="pun">(</span><span class="str">'.classy Hello World'</span><span class="pun">)</span><span class="pln"><br /></span><span class="str">'&lt;div class="classy"&gt;Hello World&lt;/div&gt;'</span><span class="pln"><br /></span></code></pre>

<p>Great, it's working!  If this is not working for you, the <a href="http://groups.google.com/group/nodejs">node mailing list</a> is a really friendly place if you need help getting this setup.</p>

<h2>A simple HAML based site</h2>

<p>As you saw in the last section, you can test it from a <code>node</code> session, but let's make a whole program with partials, loops and conditionals just for fun.</p>

<p>Note that I'm using blocking I/O for these examples to simplify the examples and focus on the haml.  If you were to use this code in the request loop of a running server, be sure you converted it to use the non-blocking versions.</p>

<h3>Layout template</h3>

<p>First let's make our layout template, we'll save it as <code>layout.haml</code>:</p>

<div class="snippet"><a href="haml-for-javascript/layout.haml" class="code-link">layout.haml</a><pre><code><span class="pun">!!!</span><span class="pln"> </span><span class="typ">Strict</span><span class="pln"><br /></span><span class="pun">%</span><span class="pln">html</span><span class="pun">(</span><span class="pln">lang</span><span class="pun">=</span><span class="str">"en"</span><span class="pun">)</span><span class="pln"><br />&nbsp; </span><span class="pun">%</span><span class="pln">head<br />&nbsp; &nbsp; </span><span class="pun">%</span><span class="pln">title</span><span class="pun">&amp;=</span><span class="pln"> title<br />&nbsp; </span><span class="pun">%</span><span class="pln">body<br />&nbsp; &nbsp; </span><span class="pun">=</span><span class="pln"> contents</span></code></pre></div>

<h3>Start of Program</h3>

<p>Now we'll write a short node program to render it:</p>

<div class="snippet"><a href="haml-for-javascript/step1.js" class="code-link">step1.js</a><pre><code><span class="kwd">var</span><span class="pln"> </span><span class="typ">Haml</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'haml'</span><span class="pun">),</span><span class="pln"><br />&nbsp; &nbsp; fs </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'fs'</span><span class="pun">);</span><span class="pln"><br /><br /></span><span class="kwd">var</span><span class="pln"> haml </span><span class="pun">=</span><span class="pln"> fs</span><span class="pun">.</span><span class="pln">readFileSync</span><span class="pun">(</span><span class="str">'layout.haml'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'utf8'</span><span class="pun">);</span><span class="pln"><br /><br /></span><span class="kwd">var</span><span class="pln"> data </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; title</span><span class="pun">:</span><span class="pln"> </span><span class="str">"Hello Node"</span><span class="pun">,</span><span class="pln"><br />&nbsp; contents</span><span class="pun">:</span><span class="pln"> </span><span class="str">"&lt;h1&gt;Hello World&lt;/h1&gt;"</span><span class="pln"><br /></span><span class="pun">};</span><span class="pln"><br /><br />console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="typ">Haml</span><span class="pun">.</span><span class="pln">render</span><span class="pun">(</span><span class="pln">haml</span><span class="pun">,</span><span class="pln"> </span><span class="pun">{</span><span class="pln">locals</span><span class="pun">:</span><span class="pln"> data</span><span class="pun">}));</span></code></pre></div>

<p>This program will output:</p>

<pre><code><span class="dec">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"&gt;</span><span class="pln"><br /></span><span class="tag">&lt;html</span><span class="pln"> </span><span class="atn">lang</span><span class="pun">=</span><span class="atv">"en"</span><span class="tag">&gt;&lt;head&gt;&lt;title&gt;</span><span class="pln">Hello Node</span><span class="tag">&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;</span><span class="pln">Hello World</span><span class="tag">&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;</span><span class="pln"><br /></span></code></pre>

<h3>Subpage</h3>

<p>Usually you'll want another template for your actual pages and just share the common layout between them.   So we'll make an actual page with a little logic in it and save it as <code>users.haml</code>.</p>

<div class="snippet"><a href="haml-for-javascript/users.haml" class="code-link">users.haml</a><pre><code><span class="pun">%</span><span class="pln">h1 </span><span class="typ">Users</span><span class="pln"><br /></span><span class="pun">:</span><span class="kwd">if</span><span class="pln"> users</span><span class="pun">.</span><span class="pln">length </span><span class="pun">===</span><span class="pln"> </span><span class="lit">0</span><span class="pln"><br />&nbsp; </span><span class="pun">%</span><span class="pln">p </span><span class="typ">There</span><span class="pln"> are </span><span class="kwd">no</span><span class="pln"> users </span><span class="kwd">in</span><span class="pln"> the system</span><span class="pun">.</span><span class="pln"><br /></span><span class="pun">:</span><span class="kwd">if</span><span class="pln"> users</span><span class="pun">.</span><span class="pln">length </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">0</span><span class="pln"><br />&nbsp; </span><span class="pun">%</span><span class="pln">ul<br />&nbsp; &nbsp; </span><span class="pun">:</span><span class="pln">each user </span><span class="kwd">in</span><span class="pln"> users<br />&nbsp; &nbsp; &nbsp; </span><span class="pun">%</span><span class="pln">li</span><span class="pun">&amp;=</span><span class="pln"> user</span></code></pre></div>

<p>There are two branches in this template.  If the users list is empty, then a static message will be shown; if not, then each user will be shown as a list item.</p>

<p>Here is how we modify the code to use this page:</p>

<div class="snippet"><a href="haml-for-javascript/step2.js" class="code-link">step2.js</a><pre><code><span class="kwd">var</span><span class="pln"> </span><span class="typ">Haml</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'haml'</span><span class="pun">),</span><span class="pln"><br />&nbsp; &nbsp; fs </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'fs'</span><span class="pun">);</span><span class="pln"><br /><br /></span><span class="kwd">var</span><span class="pln"> layoutHaml </span><span class="pun">=</span><span class="pln"> fs</span><span class="pun">.</span><span class="pln">readFileSync</span><span class="pun">(</span><span class="str">'layout.haml'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'utf8'</span><span class="pun">);</span><span class="pln"><br /></span><span class="kwd">var</span><span class="pln"> usersHaml </span><span class="pun">=</span><span class="pln"> fs</span><span class="pun">.</span><span class="pln">readFileSync</span><span class="pun">(</span><span class="str">'users.haml'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'utf8'</span><span class="pun">);</span><span class="pln"><br /><br /></span><span class="kwd">var</span><span class="pln"> data </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; users</span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span><span class="str">"Tim"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"Sally"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"George"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"James"</span><span class="pun">]</span><span class="pln"><br /></span><span class="pun">};</span><span class="pln"><br /></span><span class="kwd">var</span><span class="pln"> page_data </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; title</span><span class="pun">:</span><span class="pln"> </span><span class="str">"System Users"</span><span class="pun">,</span><span class="pln"><br />&nbsp; contents</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Haml</span><span class="pun">.</span><span class="pln">render</span><span class="pun">(</span><span class="pln">usersHaml</span><span class="pun">,</span><span class="pln"> </span><span class="pun">{</span><span class="pln">locals</span><span class="pun">:</span><span class="pln"> data</span><span class="pun">})</span><span class="pln"><br /></span><span class="pun">};</span><span class="pln"><br /></span><span class="kwd">var</span><span class="pln"> html </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Haml</span><span class="pun">.</span><span class="pln">render</span><span class="pun">(</span><span class="pln">layoutHaml</span><span class="pun">,</span><span class="pln"> </span><span class="pun">{</span><span class="pln">locals</span><span class="pun">:</span><span class="pln"> page_data</span><span class="pun">});</span><span class="pln"><br /><br />console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="pln">html</span><span class="pun">);</span></code></pre></div>

<p>And here is the output:</p>

<pre><code><span class="dec">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"&gt;</span><span class="pln"><br /></span><span class="tag">&lt;html</span><span class="pln"> </span><span class="atn">lang</span><span class="pun">=</span><span class="atv">"en"</span><span class="tag">&gt;&lt;head&gt;&lt;title&gt;</span><span class="pln">System Users</span><span class="tag">&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;</span><span class="pln">Users</span><span class="tag">&lt;/h1&gt;&lt;ul&gt;&lt;li&gt;</span><span class="pln">Tim</span><span class="tag">&lt;/li&gt;&lt;li&gt;</span><span class="pln">Sally</span><span class="tag">&lt;/li&gt;&lt;li&gt;</span><span class="pln">George</span><span class="tag">&lt;/li&gt;&lt;li&gt;</span><span class="pln">James</span><span class="tag">&lt;/li&gt;&lt;/ul&gt;&lt;/body&gt;&lt;/html&gt;</span><span class="pln"><br /></span></code></pre>

<h3>Partials</h3>

<p>Ok, now that we know how to make layout templates by passing the result of one template as a variable to another, let's learn how to do partials.  Partials are pieces of templates that are shared between several pages.</p>

<p>Here is the data we want to render:</p>

<div class="snippet"><a href="haml-for-javascript/data.js" class="code-link">data.js</a><pre><code><span class="kwd">module</span><span class="pun">.</span><span class="pln">exports </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="pln"><br />&nbsp; </span><span class="pun">{</span><span class="pln">name</span><span class="pun">:</span><span class="pln"> </span><span class="str">"Google"</span><span class="pun">,</span><span class="pln"> link</span><span class="pun">:</span><span class="pln"> </span><span class="str">"http://google.com/"</span><span class="pun">},</span><span class="pln"><br />&nbsp; </span><span class="pun">{</span><span class="pln">name</span><span class="pun">:</span><span class="pln"> </span><span class="str">"Github"</span><span class="pun">,</span><span class="pln"> link</span><span class="pun">:</span><span class="pln"> </span><span class="str">"http://github.com/"</span><span class="pun">},</span><span class="pln"><br />&nbsp; </span><span class="pun">{</span><span class="pln">name</span><span class="pun">:</span><span class="pln"> </span><span class="str">"nodejs"</span><span class="pun">,</span><span class="pln"> link</span><span class="pun">:</span><span class="pln"> </span><span class="str">"http://nodejs.org/"</span><span class="pun">},</span><span class="pln"><br />&nbsp; </span><span class="pun">{</span><span class="pln">name</span><span class="pun">:</span><span class="pln"> </span><span class="str">"HowToNode.org"</span><span class="pun">,</span><span class="pln"> link</span><span class="pun">:</span><span class="pln"> </span><span class="str">"http://howtonode.org/"</span><span class="pun">}</span><span class="pln"><br /></span><span class="pun">];</span></code></pre></div>

<p>First we'll make a partial to render each link by itself and save it as <code>link.haml</code>:</p>

<div class="snippet"><a href="haml-for-javascript/link.haml" class="code-link">link.haml</a><pre><code><span class="pun">%</span><span class="pln">li<br />&nbsp; </span><span class="pun">%</span><span class="pln">a</span><span class="pun">{</span><span class="pln">href</span><span class="pun">:</span><span class="pln"> link</span><span class="pun">}&amp;=</span><span class="pln"> name</span></code></pre></div>

<p>Then we'll make a page to render the links and save it as <code>links.haml</code>:</p>

<div class="snippet"><a href="haml-for-javascript/links.haml" class="code-link">links.haml</a><pre><code><span class="pun">%</span><span class="pln">h1 </span><span class="typ">Links</span><span class="pln"><br /></span><span class="pun">%</span><span class="pln">ul<br />&nbsp; </span><span class="pun">:</span><span class="pln">each link </span><span class="kwd">in</span><span class="pln"> links<br />&nbsp; &nbsp; </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">partial</span><span class="pun">(</span><span class="str">"link"</span><span class="pun">,</span><span class="pln"> link</span><span class="pun">)</span></code></pre></div>

<p>Since partials aren't built into <a href="http://github.com/creationix/haml-js">haml-js</a>, then we'll have to implement it in our framework.  But don't worry, it's not hard.  First we want to load and compile the templates. And this time we'll do it right using non-blocking I/O.  This code snippet will load the three haml files and compile them.  Once all three finish, the next step is called.</p>

<div class="snippet"><a href="haml-for-javascript/step3.js" class="code-link">step3.js<span class="hash">#setup</span></a><pre><code><span class="kwd">var</span><span class="pln"> template_names </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="str">"layout"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"link"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"links"</span><span class="pun">];</span><span class="pln"><br /></span><span class="kwd">var</span><span class="pln"> counter </span><span class="pun">=</span><span class="pln"> template_names</span><span class="pun">.</span><span class="pln">length</span><span class="pun">;</span><span class="pln"><br /></span><span class="kwd">var</span><span class="pln"> templates </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{};</span><span class="pln"><br />template_names</span><span class="pun">.</span><span class="pln">forEach</span><span class="pun">(</span><span class="kwd">function</span><span class="pln"> </span><span class="pun">(</span><span class="pln">name</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; fs</span><span class="pun">.</span><span class="pln">readFile</span><span class="pun">(</span><span class="pln">name </span><span class="pun">+</span><span class="pln"> </span><span class="str">".haml"</span><span class="pun">,</span><span class="pln"> </span><span class="str">'utf8'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> </span><span class="pun">(</span><span class="pln">err</span><span class="pun">,</span><span class="pln"> text</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">err</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">throw</span><span class="pln"> err</span><span class="pun">;</span><span class="pln"><br />&nbsp; &nbsp; templates</span><span class="pun">[</span><span class="pln">name</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Haml</span><span class="pun">.</span><span class="pln">compile</span><span class="pun">(</span><span class="pln">text</span><span class="pun">);</span><span class="pln"><br />&nbsp; &nbsp; counter</span><span class="pun">--;</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">counter </span><span class="pun">&lt;=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; render_page</span><span class="pun">();</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"><br />&nbsp; </span><span class="pun">});</span><span class="pln"><br /></span><span class="pun">});</span></code></pre></div>

<p>Now we can make a render function that knows how to load the saved, compiled templates:</p>

<div class="snippet"><a href="haml-for-javascript/step3.js" class="code-link">step3.js<span class="hash">#render</span></a><pre><code><span class="kwd">function</span><span class="pln"> render</span><span class="pun">(</span><span class="pln">name</span><span class="pun">,</span><span class="pln"> locals</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; </span><span class="kwd">return</span><span class="pln"> </span><span class="typ">Haml</span><span class="pun">.</span><span class="pln">execute</span><span class="pun">(</span><span class="pln">templates</span><span class="pun">[</span><span class="pln">name</span><span class="pun">],</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">,</span><span class="pln"> locals</span><span class="pun">);</span><span class="pln"><br /></span><span class="pun">}</span></code></pre></div>

<p>We're all set to define the <code>render_page</code> function referenced in the parallel loading part:</p>

<div class="snippet"><a href="haml-for-javascript/step3.js" class="code-link">step3.js<span class="hash">#renderpage</span></a><pre><code><span class="kwd">function</span><span class="pln"> render_page</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; </span><span class="kwd">var</span><span class="pln"> html </span><span class="pun">=</span><span class="pln"> render</span><span class="pun">(</span><span class="str">"layout"</span><span class="pun">,</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; title</span><span class="pun">:</span><span class="pln"> </span><span class="str">"Links"</span><span class="pun">,</span><span class="pln"><br />&nbsp; &nbsp; contents</span><span class="pun">:</span><span class="pln"> render</span><span class="pun">(</span><span class="str">"links"</span><span class="pun">,</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; </span><span class="kwd">partial</span><span class="pun">:</span><span class="pln"> render</span><span class="pun">,</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; links</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'./data'</span><span class="pun">)</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="pun">})</span><span class="pln"><br />&nbsp; </span><span class="pun">});</span><span class="pln"><br />&nbsp; console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="pln">html</span><span class="pun">);</span><span class="pln"><br /></span><span class="pun">}</span></code></pre></div>

<h3>Source Code</h3>

<p>You can find the [source code][] of the examples in the panel to the right.</p>

<p>Also, this blog itself is powered by <code>haml-js</code>.  You can see the <a href="http://github.com/creationix/howtonode.org/tree/master/skin/">templates here</a>.</p>

<h2>Using jquery-haml</h2>

<p>My other HAML project, <a href="http://github.com/creationix/jquery-haml">jquery-haml</a>, is a different beast altogether.  Instead of parsing real HAML syntax and generating HTML text, it takes a JSON structure and dom-builds from it.  There is nothing stopping you from using the text-to-text <code>haml-js</code> in a browser and inserting it into the DOM using <code>innerHTML</code>, but you can't get at the nodes as they're created because it's all done behind closed doors by the browser.</p>

<p>Here is a simple example of the <code>jquery-haml</code> syntax:</p>

<pre><code><span class="pun">[</span><span class="str">".profile"</span><span class="pun">,</span><span class="pln"><br />&nbsp; </span><span class="pun">[</span><span class="str">".left.column"</span><span class="pun">,</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="pun">[</span><span class="str">"#date"</span><span class="pun">,</span><span class="pln"> print_date</span><span class="pun">()</span><span class="pln"> </span><span class="pun">],</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="pun">[</span><span class="str">"#address"</span><span class="pun">,</span><span class="pln"> curent_user</span><span class="pun">.</span><span class="pln">address </span><span class="pun">]</span><span class="pln"><br />&nbsp; </span><span class="pun">],</span><span class="pln"><br />&nbsp; </span><span class="pun">[</span><span class="str">".right.column"</span><span class="pun">,</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="pun">[</span><span class="str">"#email"</span><span class="pun">,</span><span class="pln"> current_user</span><span class="pun">.</span><span class="pln">email </span><span class="pun">],</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="pun">[</span><span class="str">"#bio"</span><span class="pun">,</span><span class="pln"> current_user</span><span class="pun">.</span><span class="pln">bio </span><span class="pun">]</span><span class="pln"><br />&nbsp; </span><span class="pun">]</span><span class="pln"><br /></span><span class="pun">]</span><span class="pln"><br /></span></code></pre>

<p>There is nothing special here except we've taken the HAML syntax and fit it into proper JSON syntax.</p>

<p>How about this example:</p>

<pre><code><span class="pun">[</span><span class="str">"%div"</span><span class="pun">,</span><span class="pln"> </span><span class="pun">{</span><span class="pln">style</span><span class="pun">:</span><span class="pln"> </span><span class="str">"width:260px; margin:15px;"</span><span class="pun">,</span><span class="pln"> $</span><span class="pun">:{</span><span class="pln"><br />&nbsp; slider</span><span class="pun">:</span><span class="pln"> </span><span class="pun">[{</span><span class="pln">value</span><span class="pun">:</span><span class="pln"> </span><span class="lit">60</span><span class="pun">}]</span><span class="pln"><br /></span><span class="pun">}}]</span><span class="pln"><br /></span></code></pre>

<p>This creates a div element, sets the style on it, and then calls <code>$.fn.slider</code> on it!  We didn't have to give it a unique id and then search for it later with something like <code>$("#my_id").slider({value: 60})</code>, the dom-builder library did it for us right after creating the node.</p>

<p>A full depth tutorial on this library could go on for pages, but this should be enough to whet your appetite.  See the source of the <a href="http://static.creationix.com/jquery-haml/examples">sample page</a> for some more ideas.  But since this is more of an easy macro system for programmatically dom-building, then you have full control over every step.  I've written entire apps using just nested <code>jquery-haml</code> expressions and closures for data storage.</p><hr style="clear:both" /><div class="body" id="disqus_thread"></div>
<script type="text/javascript">
//<![CDATA[
var disqus_url = "http://howtonode.org/haml-for-javascript";
//]]>
</script>
<script src="http://disqus.com/forums/howtonodeorg/embed.js" type="text/javascript"></script><a href="http://disqus.com/forums/howtonodeorg/?url=ref" class="view-thread">View the discussion thread.</a><a href="http://disqus.com/" class="dsq-brlink">blog comments powered by<span class="logo-disqus">Disqus</span></a>
<script type="text/javascript">
//<![CDATA[
(function() {
  var links = document.getElementsByTagName('a');
  var query = '?';
  for(var i = 0; i < links.length; i++) {
    if(links[i].href.indexOf('#disqus_thread') >= 0) {
      query += 'url' + i + '=' + encodeURIComponent(links[i].href) + '&amp;';
    }
  }
  document.write('<script charset="utf-8" type="text/javascript" src="//disqus.com/forums/howtonodeorg/get_num_replies.js' + query + '"></' + 'script>');
})();


//]]>
</script>
</div></div><div id="sidebar"><div class="aside author"><h4>About the Author</h4><img src="https://www.gravatar.com/avatar/c953ddd239707998340e1a6fbb3eeb46?r=pg&amp;s=200.jpg&amp;d=identicon" class="headshot" /><dl><dt>Name:</dt><dd>Tim Caswell</dd></dl><dl><dt>Github:</dt><dd><a href="https://github.com/creationix">creationix</a></dd></dl><dl><dt>Twitter:</dt><dd><a href="https://twitter.com/creationix">creationix</a></dd></dl><dl><dt>Location:</dt><dd>Red Lick, TX</dd></dl><dl><dt>Links:</dt><dd><a href="http://creationix.com/">Homepage</a></dd></dl></div><div class="aside"><h4>About this Article</h4><a href="http://twitter.com/share" data-count="horizontal" data-via="creationix" class="twitter-share-button">Tweet</a><script src="http://platform.twitter.com/widgets.js"></script><dl title="Sat Feb 06 2010 23:06:39 GMT-0600 (CST)"><dt>Date Released:</dt><dd>Saturday, February  6, 2010</dd></dl><dl><dt>Node Version:</dt><dd><a href="http://github.com/joyent/node/tree/v0.1.102">node v0.1.102</a></dd></dl><dl><dt>Code Samples:</dt><dd><ul><li><a href="haml-for-javascript/layout.haml">layout.haml</a></li><li><a href="haml-for-javascript/step1.js">step1.js</a></li><li><a href="haml-for-javascript/users.haml">users.haml</a></li><li><a href="haml-for-javascript/step2.js">step2.js</a></li><li><a href="haml-for-javascript/data.js">data.js</a></li><li><a href="haml-for-javascript/link.haml">link.haml</a></li><li><a href="haml-for-javascript/links.haml">links.haml</a></li><li><a href="haml-for-javascript/step3.js">step3.js</a></li></ul></dd></dl><dl><dt>Revisions:</dt><dd><ul></ul></dd></dl></div><div class="bubble"><h3>About HowToNode.org</h3>

<p>HowToNode.org is a community supported blog created by <a href="http://creationix.com/">Tim Caswell</a>. The purpose of the blog is to teach how to do various tasks in <a href="http://nodejs.org/">node.js</a> as well as teach fundamental concepts that are needed to write effective code.</p>

<p>This site is powered by <a href="http://github.com/creationix/wheat">Wheat</a>, a git based blogging engine written in <a href="http://nodejs.org/">node.JS</a>.</p>

<p>The content for this site is stored in a <a href="http://github.com/creationix/howtonode.org">git repository</a> that anyone can fork, write an article, and send a pull request. If your article passes the quality standards it will be published and help support the greater node community.</p></div></div><div id="footer"><p>&copy; 2011-2014 Tim Caswell under the MIT license.</p><p>Content and articles are copyrighted to the individual authors. Design by&nbsp;<a href="https://bengourley.co.uk/">Ben Gourley</a>. All code snippets used in the examples are in the public domain.</p><p>Wheat v2 running on node.js v16.4.2</p></div></div>
<script type="text/javascript">
//<![CDATA[
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
//]]>
</script>

<script type="text/javascript">
//<![CDATA[
try {
var pageTracker = _gat._getTracker("UA-12824411-1");
pageTracker._trackPageview();
} catch(err) {}
//]]>
</script>
</body>
<!-- Mirrored from localhost:8080/haml-for-javascript by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 13 Jul 2021 14:00:19 GMT -->
</html>