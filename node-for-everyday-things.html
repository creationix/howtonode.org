<!DOCTYPE html>
<html lang="en">
<!-- Mirrored from localhost:8080/node-for-everyday-things by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 13 Jul 2021 13:59:46 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head><meta charset="utf-8" /><title>NodeJS for everyday things - How To Node - NodeJS</title><meta name="description" content="Learn the zen of coding in NodeJS." /><meta name="viewport" content="width=device-width" /><link href="style.css" rel="stylesheet" /><link href="print.css" rel="stylesheet" media="print" /><link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="feed.xml" /><link href="favicon.ico" rel="icon" type="image/x-icon" /></head><body><div id="container"><div id="header"><a href="index.html"><img src="logo.png" alt="How to Node" class="logo" /><div class="tagline">The zen of coding in node.js</div></a></div><div id="main"><div class="article"><h1><a href="node-for-everyday-things.html">NodeJS for everyday things</a></h1><p class="old-node-warning">HEADS UP! This article was written for an older version of node.&nbsp;More up-to-date information may be available elsewhere.</p><p>Everyday things:</p>

<blockquote>
  <p>Those little programs you write quickly to get something done like counting pages in a text document.</p>
</blockquote>

<h2>Page counting</h2>

<p>Recently I was writing an essay and I needed to calculate a page count. My text editor was great at giving me a word count. I used the result and divided it by 350 to ball park my page count. This became problematic because I'm lousy at doing math in my head. Next I decided to chain some Unix commands together to do the job. I played with Bash, Unix's wc and cut commands I came up with this:</p>

<pre><code><span class="com">#!/usr/bin/env bash</span><span class="pln"><br />let x</span><span class="pun">=</span><span class="pln">$</span><span class="pun">(</span><span class="pln">wc </span><span class="pun">-</span><span class="pln">w $1 </span><span class="pun">|</span><span class="pln"> cut </span><span class="pun">-</span><span class="pln">d</span><span class="pun">\</span><span class="pln"> &nbsp;</span><span class="pun">-</span><span class="pln">f </span><span class="lit">1</span><span class="pun">)/</span><span class="lit">350</span><span class="pln"><br />echo </span><span class="str">"Page count for $1 is $x"</span><span class="pun">;</span><span class="pln"><br /></span></code></pre>

<p>This was nice. It was short. It worked but I wanted to procrastinate a little more. I started thinking about the lack of nuance in this approach. What was wc really counting? How was it handling punctuation and new lines? I could have tracked down the source code for wc but that seemed a little excessive. I pondered on - process the file with sed before piping it to wc; wrap it in a function for processing multiple files; keep a running total and pipe stats into an SQLite database. I found myself running down the rabbit and out to the sea. It is truly impressive what you can conjure up from the Unix command line and build into a nice little complicated shell script. Sometimes it is easier to visualize something in one language. I thought of Node.</p>

<p>The page count problems are basically a simple analysis of text with some accounting. Could I quickly write a program using node to do something so mundane? Yes and it was surprisingly straight forward. I fired up node-repl and started playing around before typing up this:</p>

<div class="snippet"><a href="node-for-everyday-things/word-count.js" class="code-link">word-count.js</a><pre><code><span class="com">#!/usr/bin/env node</span><span class="pln"><br /></span><span class="com">/**<br />&nbsp;* Calculate the approximate the number of "pages" in a text document based on<br />&nbsp;* a word count of 350 words per page.<br />&nbsp;*/</span><span class="pln"><br /><br /></span><span class="kwd">var</span><span class="pln"> sys </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'sys'</span><span class="pun">),</span><span class="pln"><br />&nbsp; &nbsp; fs </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'fs'</span><span class="pun">);</span><span class="pln"><br /><br /></span><span class="com">/* Include some instructions for when I forget how this works. */</span><span class="pln"><br /></span><span class="kwd">function</span><span class="pln"> USAGE</span><span class="pun">(</span><span class="pln">message</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; </span><span class="kwd">var</span><span class="pln"> error_code </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"><br />&nbsp; sys</span><span class="pun">.</span><span class="pln">puts</span><span class="pun">(</span><span class="str">"\n &nbsp;USAGE: pagecount FILENAME\n\n"</span><span class="pln"> </span><span class="pun">+</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="str">" &nbsp;Show the estimated page count of a file based on 350 words per page.\n"</span><span class="pln"> </span><span class="pun">+</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="str">" &nbsp;FILENAME should be the name of a utf-8 encoded text file.\n"</span><span class="pln"> </span><span class="pun">+</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="str">"\b\n"</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> <br />&nbsp; &nbsp; </span><span class="str">" &nbsp;Example:\n\t\tpagecount MyFile.txt\n\n &nbsp;Estimates the page count of MyFile.txt\n"</span><span class="pun">);</span><span class="pln"><br /><br />&nbsp; </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">message </span><span class="pun">!==</span><span class="pln"> </span><span class="kwd">undefined</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; sys</span><span class="pun">.</span><span class="pln">puts</span><span class="pun">(</span><span class="pln">message</span><span class="pun">);</span><span class="pln"><br />&nbsp; &nbsp; error_code </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"><br />&nbsp; </span><span class="pun">}</span><span class="pln"><br />&nbsp; process</span><span class="pun">.</span><span class="kwd">exit</span><span class="pun">(</span><span class="pln">error_code</span><span class="pun">);</span><span class="pln"><br /></span><span class="pun">};</span><span class="pln"><br /><br /></span><span class="com">/* PageCount() analyze the file and displays the results */</span><span class="pln"><br /></span><span class="kwd">function</span><span class="pln"> </span><span class="typ">PageCount</span><span class="pun">(</span><span class="pln">filename</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; fs</span><span class="pun">.</span><span class="pln">stat</span><span class="pun">(</span><span class="pln">filename</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> </span><span class="pun">(</span><span class="pln">stat_error</span><span class="pun">,</span><span class="pln"> stat</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">stat_error</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; USAGE</span><span class="pun">(</span><span class="str">"ERROR: "</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> filename </span><span class="pun">+</span><span class="pln"> </span><span class="str">", "</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> stat_error</span><span class="pun">);</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"><br /><br />&nbsp; &nbsp; </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">stat</span><span class="pun">.</span><span class="pln">isFile</span><span class="pun">())</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; fs</span><span class="pun">.</span><span class="pln">readFile</span><span class="pun">(</span><span class="pln">filename</span><span class="pun">,</span><span class="pln"> </span><span class="str">'utf8'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> </span><span class="pun">(</span><span class="pln">read_error</span><span class="pun">,</span><span class="pln"> content</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">var</span><span class="pln"> subtotal_words </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">read_error</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; USAGE</span><span class="pun">(</span><span class="str">"ERROR: Can't read "</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> filename </span><span class="pun">+</span><span class="pln"> </span><span class="str">". "</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> read_error</span><span class="pun">);</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">/* Replace all non-letter characters with a single space. */</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; subtotal_words </span><span class="pun">=</span><span class="pln"> content</span><span class="pun">.</span><span class="pln">replace</span><span class="pun">(</span><span class="str">/\W+|\s+/</span><span class="pln">gm</span><span class="pun">,</span><span class="str">' '</span><span class="pun">).</span><span class="pln">split</span><span class="pun">(</span><span class="str">' '</span><span class="pun">).</span><span class="pln">length</span><span class="pun">;</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; page_count </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">subtotal_words</span><span class="pun">/</span><span class="lit">350</span><span class="pun">);</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Number</span><span class="pun">(</span><span class="pln">page_count</span><span class="pun">).</span><span class="pln">toFixed</span><span class="pun">(</span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&lt;=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sys</span><span class="pun">.</span><span class="pln">puts</span><span class="pun">(</span><span class="pln">filename </span><span class="pun">+</span><span class="pln"> </span><span class="str">"("</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> subtotal_words </span><span class="pun">+</span><span class="pln"> </span><span class="str">" words): "</span><span class="pln"> </span><span class="pun">+</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="typ">Number</span><span class="pun">(</span><span class="pln">page_count </span><span class="pun">*</span><span class="pln"> </span><span class="lit">100</span><span class="pun">).</span><span class="pln">toFixed</span><span class="pun">(</span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="str">"% of one page."</span><span class="pun">);</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sys</span><span class="pun">.</span><span class="pln">puts</span><span class="pun">(</span><span class="pln">filename </span><span class="pun">+</span><span class="pln"> </span><span class="str">"("</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> subtotal_words </span><span class="pun">+</span><span class="pln"> </span><span class="str">" words):"</span><span class="pln"> </span><span class="pun">+</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="typ">Number</span><span class="pun">(</span><span class="pln">page_count</span><span class="pun">).</span><span class="pln">toFixed</span><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="str">" pages."</span><span class="pun">);</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; </span><span class="pun">});</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; USAGE</span><span class="pun">(</span><span class="str">"ERROR: "</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> filename </span><span class="pun">+</span><span class="pln"> </span><span class="str">" is not a file."</span><span class="pun">);</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"><br />&nbsp; </span><span class="pun">});</span><span class="pln"><br /></span><span class="pun">};</span><span class="pln"><br /><br /></span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">process</span><span class="pun">.</span><span class="pln">argv</span><span class="pun">.</span><span class="pln">length </span><span class="pun">&lt;</span><span class="pln"> </span><span class="lit">3</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; USAGE</span><span class="pun">();</span><span class="pln"><br /></span><span class="pun">}</span><span class="pln"><br /><br /></span><span class="com">/* For each file I want to tally up call PageCount() */</span><span class="pln"><br /></span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">var</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">2</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> process</span><span class="pun">.</span><span class="pln">argv</span><span class="pun">.</span><span class="pln">length</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">+=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; </span><span class="typ">PageCount</span><span class="pun">(</span><span class="pln">process</span><span class="pun">.</span><span class="pln">argv</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]);</span><span class="pln"><br /></span><span class="pun">}</span></code></pre></div>

<p><code>pagecount</code> reports the plain text version of this essay is 636 words or 1.82 pages including the source code examples. It's a little longer than my shell script. On the other hand it is easier to read and with a little modification I can embed it as a web service or put it into a web page.</p><hr style="clear:both" /><div class="body" id="disqus_thread"></div>
<script type="text/javascript">
//<![CDATA[
var disqus_url = "http://howtonode.org/node-for-everyday-things";
//]]>
</script>
<script src="http://disqus.com/forums/howtonodeorg/embed.js" type="text/javascript"></script><a href="http://disqus.com/forums/howtonodeorg/?url=ref" class="view-thread">View the discussion thread.</a><a href="http://disqus.com/" class="dsq-brlink">blog comments powered by<span class="logo-disqus">Disqus</span></a>
<script type="text/javascript">
//<![CDATA[
(function() {
  var links = document.getElementsByTagName('a');
  var query = '?';
  for(var i = 0; i < links.length; i++) {
    if(links[i].href.indexOf('#disqus_thread') >= 0) {
      query += 'url' + i + '=' + encodeURIComponent(links[i].href) + '&amp;';
    }
  }
  document.write('<script charset="utf-8" type="text/javascript" src="//disqus.com/forums/howtonodeorg/get_num_replies.js' + query + '"></' + 'script>');
})();


//]]>
</script>
</div></div><div id="sidebar"><div class="aside author"><h4>About the Author</h4><img src="https://www.gravatar.com/avatar/60c7b20527f236c7156a85772a97430f?r=pg&amp;s=200.jpg&amp;d=identicon" class="headshot" /><dl><dt>Name:</dt><dd>R. S. Doiel</dd></dl><dl><dt>Github:</dt><dd><a href="https://github.com/rsdoiel">rsdoiel</a></dd></dl><dl><dt>Links:</dt><dd><a href="http://phizcode.blogspot.com/">Homepage</a></dd></dl></div><div class="aside"><h4>About this Article</h4><a href="http://twitter.com/share" data-count="horizontal" data-via="creationix" class="twitter-share-button">Tweet</a><script src="http://platform.twitter.com/widgets.js"></script><dl title="Fri Feb 19 2010 14:20:20 GMT-0800 (PST)"><dt>Date Released:</dt><dd>Friday, February 19, 2010</dd></dl><dl><dt>Node Version:</dt><dd><a href="http://github.com/joyent/node/tree/v0.1.91">node v0.1.91</a></dd></dl><dl><dt>Code Samples:</dt><dd><ul><li><a href="node-for-everyday-things/word-count.js">word-count.js</a></li></ul></dd></dl><dl><dt>Revisions:</dt><dd><ul></ul></dd></dl></div><div class="bubble"><h3>About HowToNode.org</h3>

<p>HowToNode.org is a community supported blog created by <a href="http://creationix.com/">Tim Caswell</a>. The purpose of the blog is to teach how to do various tasks in <a href="http://nodejs.org/">node.js</a> as well as teach fundamental concepts that are needed to write effective code.</p>

<p>This site is powered by <a href="http://github.com/creationix/wheat">Wheat</a>, a git based blogging engine written in <a href="http://nodejs.org/">node.JS</a>.</p>

<p>The content for this site is stored in a <a href="http://github.com/creationix/howtonode.org">git repository</a> that anyone can fork, write an article, and send a pull request. If your article passes the quality standards it will be published and help support the greater node community.</p></div></div><div id="footer"><p>&copy; 2011-2014 Tim Caswell under the MIT license.</p><p>Content and articles are copyrighted to the individual authors. Design by&nbsp;<a href="https://bengourley.co.uk/">Ben Gourley</a>. All code snippets used in the examples are in the public domain.</p><p>Wheat v2 running on node.js v16.4.2</p></div></div>
<script type="text/javascript">
//<![CDATA[
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
//]]>
</script>

<script type="text/javascript">
//<![CDATA[
try {
var pageTracker = _gat._getTracker("UA-12824411-1");
pageTracker._trackPageview();
} catch(err) {}
//]]>
</script>
</body>
<!-- Mirrored from localhost:8080/node-for-everyday-things by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 13 Jul 2021 13:59:47 GMT -->
</html>