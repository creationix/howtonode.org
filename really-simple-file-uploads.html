<!DOCTYPE html>
<html lang="en">
<!-- Mirrored from localhost:8080/really-simple-file-uploads by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 13 Jul 2021 13:57:04 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head><meta charset="utf-8" /><title>Really simple file uploads with Express - How To Node - NodeJS</title><meta name="description" content="Learn the zen of coding in NodeJS." /><meta name="viewport" content="width=device-width" /><link href="style.css" rel="stylesheet" /><link href="print.css" rel="stylesheet" media="print" /><link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="feed.xml" /><link href="favicon.ico" rel="icon" type="image/x-icon" /></head><body><div id="container"><div id="header"><a href="index.html"><img src="logo.png" alt="How to Node" class="logo" /><div class="tagline">The zen of coding in node.js</div></a></div><div id="main"><div class="article"><h1><a href="really-simple-file-uploads.html">Really simple file uploads with Express</a></h1><p class="old-node-warning">HEADS UP! This article was written for an older version of node.&nbsp;More up-to-date information may be available elsewhere.</p><p>Few days ago I was working on a fairly typical web application and I faced the challenge of implementing a fairly
typical web application feature - file uploads. It was the first time I was implementing file uploads with Node (and
Express) and I did what anyone else would do - I googled it.</p>

<p>Unfortunately all the articles / posts out there are either outdated, too complex or plain wrong. So I did the next
most obvious thing - post a question on the mailing list. As always Mr. Holowaychuk was incredibly quick to respond.
His answer lead me to do what I should have done in the first place - read the docs.</p>

<h2>The upload form</h2>

<p>This is the most obvious part of the challenge. You're probably familiar with this already. Anyway, for the sake of
completeness of this article, here it is.</p>

<p>You will need a form in your browser for the file upload. I use Jade to generate my HTML and here how it looks:</p>

<pre><code><span class="pln">form</span><span class="pun">(</span><span class="pln">action</span><span class="pun">=</span><span class="str">"..."</span><span class="pun">,</span><span class="pln"> method</span><span class="pun">=</span><span class="str">"post"</span><span class="pun">,</span><span class="pln"> enctype</span><span class="pun">=</span><span class="str">"multipart/form-data"</span><span class="pun">)</span><span class="pln"><br />&nbsp; input</span><span class="pun">(</span><span class="pln">type</span><span class="pun">=</span><span class="str">"file"</span><span class="pun">,</span><span class="pln"> name</span><span class="pun">=</span><span class="str">"displayImage"</span><span class="pun">)</span><span class="pln"><br /></span></code></pre>

<p>The <em>form.action</em> will point to a route that handles the file upload. More below.</p>

<h2>Accessing the uploaded file</h2>

<p>If you're using recents versions of Node and Express, file uploads are a piece of cake. And I'll back this claim but
before we go any further make sure you're familiar with <a href="http://expressjs.com/guide.html">routes, requests and responses in Express</a>.</p>

<p>Okay, now let's justify the "piece of cake" claim. In our file upload route, the <em>req</em> parameter has <em>req.files</em>
available. Here's an example of what the <em>req.files</em> would contain:</p>

<pre><code><span class="pun">{</span><span class="pln"><br />&nbsp; displayImage</span><span class="pun">:</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; size</span><span class="pun">:</span><span class="pln"> </span><span class="lit">11885</span><span class="pun">,</span><span class="pln"><br />&nbsp; &nbsp; path</span><span class="pun">:</span><span class="pln"> </span><span class="str">'/tmp/1574bb60b4f7e0211fd9ab48f932f3ab'</span><span class="pun">,</span><span class="pln"><br />&nbsp; &nbsp; name</span><span class="pun">:</span><span class="pln"> </span><span class="str">'avatar.png'</span><span class="pun">,</span><span class="pln"><br />&nbsp; &nbsp; type</span><span class="pun">:</span><span class="pln"> </span><span class="str">'image/png'</span><span class="pun">,</span><span class="pln"><br />&nbsp; &nbsp; lastModifiedDate</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Sun</span><span class="pun">,</span><span class="pln"> </span><span class="lit">05</span><span class="pln"> </span><span class="typ">Feb</span><span class="pln"> </span><span class="lit">2012</span><span class="pln"> </span><span class="lit">05</span><span class="pun">:</span><span class="lit">31</span><span class="pun">:</span><span class="lit">09</span><span class="pln"> GMT</span><span class="pun">,</span><span class="pln"><br />&nbsp; &nbsp; _writeStream</span><span class="pun">:</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; path</span><span class="pun">:</span><span class="pln"> </span><span class="str">'/tmp/1574bb60b4f7e0211fd9ab48f932f3ab'</span><span class="pun">,</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; fd</span><span class="pun">:</span><span class="pln"> </span><span class="lit">14</span><span class="pun">,</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; writable</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">,</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; flags</span><span class="pun">:</span><span class="pln"> </span><span class="str">'w'</span><span class="pun">,</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; encoding</span><span class="pun">:</span><span class="pln"> </span><span class="str">'binary'</span><span class="pun">,</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; mode</span><span class="pun">:</span><span class="pln"> </span><span class="lit">438</span><span class="pun">,</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; bytesWritten</span><span class="pun">:</span><span class="pln"> </span><span class="lit">11885</span><span class="pun">,</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; busy</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">,</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; _queue</span><span class="pun">:</span><span class="pln"> </span><span class="pun">[],</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; drainable</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">true</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="pun">},</span><span class="pln"><br />&nbsp; &nbsp; length</span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span><span class="typ">Getter</span><span class="pun">],</span><span class="pln"><br />&nbsp; &nbsp; filename</span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span><span class="typ">Getter</span><span class="pun">],</span><span class="pln"><br />&nbsp; &nbsp; mime</span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span><span class="typ">Getter</span><span class="pun">]</span><span class="pln"><br />&nbsp; </span><span class="pun">}</span><span class="pln"><br /></span><span class="pun">}</span><span class="pln"><br /></span></code></pre>

<p>In the <em>req.files</em> object above, the property <em>displayImage</em> is the name of the file field in your HTML form and
<em>req.files</em> will contain one property each for every valid HTML file form field.</p>

<p>The file object contains the <em>type</em>, <em>size</em> and <em>name</em> properties for your server side validations.</p>

<h2>Saving the uploaded file</h2>

<p>Assuming the file is valid, you use the <em>path</em> property for the next step. The <em>path</em> would typically contain a location
in the <em>tmp</em> folder. Your application logic could either require you to access the contents of the file or simply move
the uploaded file to another location.</p>

<pre><code><span class="pln">fs</span><span class="pun">.</span><span class="pln">readFile</span><span class="pun">(</span><span class="pln">req</span><span class="pun">.</span><span class="pln">files</span><span class="pun">.</span><span class="pln">displayImage</span><span class="pun">.</span><span class="pln">path</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> </span><span class="pun">(</span><span class="pln">err</span><span class="pun">,</span><span class="pln"> data</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; </span><span class="com">// ...</span><span class="pln"><br />&nbsp; </span><span class="kwd">var</span><span class="pln"> newPath </span><span class="pun">=</span><span class="pln"> __dirname </span><span class="pun">+</span><span class="pln"> </span><span class="str">"/uploads/uploadedFileName"</span><span class="pun">;</span><span class="pln"><br />&nbsp; fs</span><span class="pun">.</span><span class="pln">writeFile</span><span class="pun">(</span><span class="pln">newPath</span><span class="pun">,</span><span class="pln"> data</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> </span><span class="pun">(</span><span class="pln">err</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; res</span><span class="pun">.</span><span class="pln">redirect</span><span class="pun">(</span><span class="str">"back"</span><span class="pun">);</span><span class="pln"><br />&nbsp; </span><span class="pun">});</span><span class="pln"><br /></span><span class="pun">});</span><span class="pln"><br /></span></code></pre>

<p>In the <em>fs.readFile</em> callback, we have the <em>data</em> parameter through which we can access the contents of the file. The
example above is taken from an application that needed to modify the file and save it in a new location. Thus
<em>fs.writeFile</em> is used to write <em>data</em> to the <em>newPath</em>.</p>

<p>If your app needs to simply move the uploaded file without modifying the contents <em>fs.rename</em> can be used as more
simpler option.</p>

<hr />

<p>That's all there is to it. I've done file uploads in many server side languages including Python, Java, Scala and PHP
and I don't think its ever been this simple. So much for JavaScript being labeled as an inferior server side language.</p><hr style="clear:both" /><div class="body" id="disqus_thread"></div>
<script type="text/javascript">
//<![CDATA[
var disqus_url = "http://howtonode.org/really-simple-file-uploads";
//]]>
</script>
<script src="http://disqus.com/forums/howtonodeorg/embed.js" type="text/javascript"></script><a href="http://disqus.com/forums/howtonodeorg/?url=ref" class="view-thread">View the discussion thread.</a><a href="http://disqus.com/" class="dsq-brlink">blog comments powered by<span class="logo-disqus">Disqus</span></a>
<script type="text/javascript">
//<![CDATA[
(function() {
  var links = document.getElementsByTagName('a');
  var query = '?';
  for(var i = 0; i < links.length; i++) {
    if(links[i].href.indexOf('#disqus_thread') >= 0) {
      query += 'url' + i + '=' + encodeURIComponent(links[i].href) + '&amp;';
    }
  }
  document.write('<script charset="utf-8" type="text/javascript" src="//disqus.com/forums/howtonodeorg/get_num_replies.js' + query + '"></' + 'script>');
})();


//]]>
</script>
</div></div><div id="sidebar"><div class="aside author"><h4>About the Author</h4><img src="https://www.gravatar.com/avatar/40bec8c5a2a804cc48ab9d8443592b90?r=pg&amp;s=200.jpg&amp;d=identicon" class="headshot" /><dl><dt>Name:</dt><dd>Srirangan</dd></dl><dl><dt>Github:</dt><dd><a href="https://github.com/Srirangan">Srirangan</a></dd></dl><dl><dt>Twitter:</dt><dd><a href="https://twitter.com/srirangan">srirangan</a></dd></dl><dl><dt>Links:</dt><dd><a href="http://srirangan.net/">Homepage</a></dd></dl></div><div class="aside"><h4>About this Article</h4><a href="http://twitter.com/share" data-count="horizontal" data-via="creationix" class="twitter-share-button">Tweet</a><script src="http://platform.twitter.com/widgets.js"></script><dl title="Sun Feb 05 2012 11:00:00 GMT+0530 (IST)"><dt>Date Released:</dt><dd>Saturday, February  4, 2012</dd></dl><dl><dt>Node Version:</dt><dd><a href="http://github.com/joyent/node/tree/v0.6.10">node v0.6.10</a></dd></dl><dl><dt>Revisions:</dt><dd><ul></ul></dd></dl></div><div class="bubble"><h3>About HowToNode.org</h3>

<p>HowToNode.org is a community supported blog created by <a href="http://creationix.com/">Tim Caswell</a>. The purpose of the blog is to teach how to do various tasks in <a href="http://nodejs.org/">node.js</a> as well as teach fundamental concepts that are needed to write effective code.</p>

<p>This site is powered by <a href="http://github.com/creationix/wheat">Wheat</a>, a git based blogging engine written in <a href="http://nodejs.org/">node.JS</a>.</p>

<p>The content for this site is stored in a <a href="http://github.com/creationix/howtonode.org">git repository</a> that anyone can fork, write an article, and send a pull request. If your article passes the quality standards it will be published and help support the greater node community.</p></div></div><div id="footer"><p>&copy; 2011-2014 Tim Caswell under the MIT license.</p><p>Content and articles are copyrighted to the individual authors. Design by&nbsp;<a href="https://bengourley.co.uk/">Ben Gourley</a>. All code snippets used in the examples are in the public domain.</p><p>Wheat v2 running on node.js v16.4.2</p></div></div>
<script type="text/javascript">
//<![CDATA[
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
//]]>
</script>

<script type="text/javascript">
//<![CDATA[
try {
var pageTracker = _gat._getTracker("UA-12824411-1");
pageTracker._trackPageview();
} catch(err) {}
//]]>
</script>
</body>
<!-- Mirrored from localhost:8080/really-simple-file-uploads by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 13 Jul 2021 13:57:04 GMT -->
</html>