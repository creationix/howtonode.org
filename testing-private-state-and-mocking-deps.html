<!DOCTYPE html>
<html lang="en">
<!-- Mirrored from localhost:8080/testing-private-state-and-mocking-deps by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 13 Jul 2021 13:57:04 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head><meta charset="utf-8" /><title>Testing Private State and Mocking Dependencies - How To Node - NodeJS</title><meta name="description" content="Learn the zen of coding in NodeJS." /><meta name="viewport" content="width=device-width" /><link href="style.css" rel="stylesheet" /><link href="print.css" rel="stylesheet" media="print" /><link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="feed.xml" /><link href="favicon.ico" rel="icon" type="image/x-icon" /></head><body><div id="container"><div id="header"><a href="index.html"><img src="logo.png" alt="How to Node" class="logo" /><div class="tagline">The zen of coding in node.js</div></a></div><div id="main"><div class="article"><h1><a href="testing-private-state-and-mocking-deps.html">Testing Private State and Mocking Dependencies</a></h1><p class="old-node-warning">HEADS UP! This article was written for an older version of node.&nbsp;More up-to-date information may be available elsewhere.</p><p>During Christmas I've been working on <a href="http://github.com/vojtajina/testacular/">Testacular</a> and found some tricks how to make my testing life
easier. It's nothing special at all, just a simple way <strong>how to access private state of a module</strong>
and <strong>how to mock out some dependencies</strong>. I've found these two techniques pretty usefull, so I
believe it might help someone else as well...</p>

<h3>Why would you need to access private state of a module?</h3>

<p>Private should be private, right? Yes, for sure. But during unit tests, it can be very helpful to
have access to private state of a module - I always try to cover functionality or bug at the lowest
possible level, because it's simply cheaper:</p>

<ul>
<li>faster test execution</li>
<li>less code is required to bootstrap the test</li>
</ul>

<p>Let's say we are building very simple static web server, the skeleton might look something like
this:</p>

<pre><code><span class="kwd">var</span><span class="pln"> http </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'http'</span><span class="pun">);</span><span class="pln"><br /><br /></span><span class="kwd">var</span><span class="pln"> handleRequest </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">request</span><span class="pun">,</span><span class="pln"> response</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; </span><span class="com">// read file from fs and send response</span><span class="pln"><br /></span><span class="pun">};</span><span class="pln"><br /><br />exports</span><span class="pun">.</span><span class="pln">createServer </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; </span><span class="kwd">return</span><span class="pln"> http</span><span class="pun">.</span><span class="pln">createServer</span><span class="pun">(</span><span class="pln">handleRequest</span><span class="pun">);</span><span class="pln"><br /></span><span class="pun">};</span><span class="pln"><br /></span></code></pre>

<p>This module has only one public method <code>createServer</code>, so unless we make it public, we can't get
hold of anything else but this method. That sucks, because <code>HttpServer</code> doesn't have any public
method to call the handler, so we would have to send some data through socket to test it. That's way
too much effort, especially when you realize that the only code we really need to test is the
<code>handleRequest</code> function - everything else is just Node and we trust Node, because it's awesome. We
need to test <strong>our</strong> code - that's where all the bugs are.</p>

<h3>Why would you need to mock out dependencies?</h3>

<p>Some dependencies are cheap, some not. When our code uses modules like <code>util</code> or <code>path</code>, we are
fine. Nothing bad happens there. But when it comes to some other modules like <code>fs</code>, <code>net</code> or <code>http</code>,
it's totally different story. We simply don't want to deal with real filesystem in unit tests. There
are many reasons for that, such as:</p>

<ul>
<li>accessing file system is slow</li>
<li>it requires seting up some state of filesystem</li>
<li>there is only one instance of filesystem, so conflicts between different unit tests might happen</li>
</ul>

<p>So we want our module to use something different - we call these objects test doubles (I actually
like using mock/stub/dummy definition from <a href="http://xunitpatterns.com/Test Double.html">G.Meszaros</a>). The question is, how can we persuade our
awesome module, to use <strong>a different instance during testing and different instance in production</strong>?</p>

<p><strong>Dependency Injection</strong> is great for this - it wires all the pieces together (yep, it saves us lot
of work) - and more than that, it does allow us to use different instances during testing. Yep, DI is
just awesome! I actually think, that new languages such as <a href="http://www.dartlang.org/">Dart</a> should support DI natively - in the
same way as they do support memory management.</p>

<p>Unfortunately, there is no DI in Node, at least I haven't found any sufficient implementation.
Writing a Dependency Injection framework is definitely a solution, but I was looking for something
faster...</p>

<h2>Let's do it !</h2>

<h3>Module Loader</h3>

<div class="snippet"><a href="testing-private-state-and-mocking-deps/module-loader.js" class="code-link">module-loader.js</a><pre><code><span class="kwd">var</span><span class="pln"> vm </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'vm'</span><span class="pun">);</span><span class="pln"><br /></span><span class="kwd">var</span><span class="pln"> fs </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'fs'</span><span class="pun">);</span><span class="pln"><br /></span><span class="kwd">var</span><span class="pln"> path </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'path'</span><span class="pun">);</span><span class="pln"><br /><br /></span><span class="com">/**<br />&nbsp;* Helper for unit testing:<br />&nbsp;* - load module with mocked dependencies<br />&nbsp;* - allow accessing private state of the module<br />&nbsp;*<br />&nbsp;* @param {string} filePath Absolute path to module (file to load)<br />&nbsp;* @param {Object=} mocks Hash of mocked dependencies<br />&nbsp;*/</span><span class="pln"><br />exports</span><span class="pun">.</span><span class="pln">loadModule </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">filePath</span><span class="pun">,</span><span class="pln"> mocks</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; mocks </span><span class="pun">=</span><span class="pln"> mocks </span><span class="pun">||</span><span class="pln"> </span><span class="pun">{};</span><span class="pln"><br /><br />&nbsp; </span><span class="com">// this is necessary to allow relative path modules within loaded file</span><span class="pln"><br />&nbsp; </span><span class="com">// i.e. requiring ./some inside file /a/b.js needs to be resolved to /a/some</span><span class="pln"><br />&nbsp; </span><span class="kwd">var</span><span class="pln"> resolveModule </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="kwd">module</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">module</span><span class="pun">.</span><span class="pln">charAt</span><span class="pun">(</span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">!==</span><span class="pln"> </span><span class="str">'.'</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">module</span><span class="pun">;</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="kwd">return</span><span class="pln"> path</span><span class="pun">.</span><span class="pln">resolve</span><span class="pun">(</span><span class="pln">path</span><span class="pun">.</span><span class="pln">dirname</span><span class="pun">(</span><span class="pln">filePath</span><span class="pun">),</span><span class="pln"> </span><span class="kwd">module</span><span class="pun">);</span><span class="pln"><br />&nbsp; </span><span class="pun">};</span><span class="pln"><br /><br />&nbsp; </span><span class="kwd">var</span><span class="pln"> exports </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{};</span><span class="pln"><br />&nbsp; </span><span class="kwd">var</span><span class="pln"> context </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="kwd">require</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">name</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; </span><span class="kwd">return</span><span class="pln"> mocks</span><span class="pun">[</span><span class="pln">name</span><span class="pun">]</span><span class="pln"> </span><span class="pun">||</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="pln">resolveModule</span><span class="pun">(</span><span class="pln">name</span><span class="pun">));</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="pun">},</span><span class="pln"><br />&nbsp; &nbsp; console</span><span class="pun">:</span><span class="pln"> console</span><span class="pun">,</span><span class="pln"><br />&nbsp; &nbsp; exports</span><span class="pun">:</span><span class="pln"> exports</span><span class="pun">,</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="kwd">module</span><span class="pun">:</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; exports</span><span class="pun">:</span><span class="pln"> exports<br />&nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"><br />&nbsp; </span><span class="pun">};</span><span class="pln"><br /><br />&nbsp; vm</span><span class="pun">.</span><span class="pln">runInNewContext</span><span class="pun">(</span><span class="pln">fs</span><span class="pun">.</span><span class="pln">readFileSync</span><span class="pun">(</span><span class="pln">filePath</span><span class="pun">),</span><span class="pln"> context</span><span class="pun">);</span><span class="pln"><br />&nbsp; </span><span class="kwd">return</span><span class="pln"> context</span><span class="pun">;</span><span class="pln"><br /></span><span class="pun">};</span></code></pre></div>

<p><strong>This is actually the code this post is all about :-D</strong></p>

<p>Instead of using Node's <code>require</code>, we use <code>loadModule</code> function, which reads the content of
requested module (javascript source file) and executes it on the <code>context</code> object. So all the
private state of the module is dumped into the <code>context</code> object and yay, we can access everything!
See <a href="http://nodejs.org/docs/latest/api/vm.html#vm.runInNewContext">vm.runInNewContext</a> for more info.</p>

<p>Inside this <code>context</code> object, we defined our own <code>require</code> function, which means whenever the module
asks for a dependency, our <code>loadModule</code> will be called intead of Node's <code>require</code>. That's pretty
cool, because <strong>we can decide, whether we want to return a mock or real module</strong>, in which case we
delegate the request to Node's <code>require</code>.</p>

<h3>Very simple web server example</h3>

<div class="snippet"><a href="testing-private-state-and-mocking-deps/web-server.js" class="code-link">web-server.js</a><pre><code><span class="com">// this returns either real fs or mock fs (in test)</span><span class="pln"><br /></span><span class="kwd">var</span><span class="pln"> fs </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'fs'</span><span class="pun">);</span><span class="pln"><br /></span><span class="kwd">var</span><span class="pln"> http </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'http'</span><span class="pun">);</span><span class="pln"><br /><br /></span><span class="kwd">var</span><span class="pln"> MIME_TYPE </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; txt</span><span class="pun">:</span><span class="pln"> </span><span class="str">'text/plain'</span><span class="pun">,</span><span class="pln"><br />&nbsp; html</span><span class="pun">:</span><span class="pln"> </span><span class="str">'text/html'</span><span class="pun">,</span><span class="pln"><br />&nbsp; js</span><span class="pun">:</span><span class="pln"> </span><span class="str">'application/javascript'</span><span class="pln"><br /></span><span class="pun">};</span><span class="pln"><br /><br /></span><span class="com">// we can access and test this function directly, without instantiating anything</span><span class="pln"><br /></span><span class="kwd">var</span><span class="pln"> extensionFromUrl </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">url</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; </span><span class="kwd">return</span><span class="pln"> url</span><span class="pun">.</span><span class="pln">split</span><span class="pun">(</span><span class="str">'.'</span><span class="pun">).</span><span class="pln">pop</span><span class="pun">();</span><span class="pln"> </span><span class="com">//.replace(/\?.*$/, '');</span><span class="pln"><br /></span><span class="pun">};</span><span class="pln"><br /><br /></span><span class="kwd">var</span><span class="pln"> handleRequest </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">request</span><span class="pun">,</span><span class="pln"> response</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; fs</span><span class="pun">.</span><span class="pln">readFile</span><span class="pun">(</span><span class="pln">__dirname </span><span class="pun">+</span><span class="pln"> request</span><span class="pun">.</span><span class="pln">url</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">error</span><span class="pun">,</span><span class="pln"> data</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="kwd">var</span><span class="pln"> contentType </span><span class="pun">=</span><span class="pln"> MIME_TYPE</span><span class="pun">[</span><span class="pln">extensionFromUrl</span><span class="pun">(</span><span class="pln">request</span><span class="pun">.</span><span class="pln">url</span><span class="pun">)]</span><span class="pln"> </span><span class="pun">||</span><span class="pln"> MIME_TYPE</span><span class="pun">.</span><span class="pln">txt</span><span class="pun">;</span><span class="pln"><br />&nbsp; &nbsp; response</span><span class="pun">.</span><span class="pln">setHeader</span><span class="pun">(</span><span class="str">'Content-Type'</span><span class="pun">,</span><span class="pln"> contentType</span><span class="pun">);</span><span class="pln"><br />&nbsp; &nbsp; response</span><span class="pun">.</span><span class="pln">writeHead</span><span class="pun">(</span><span class="pln">error </span><span class="pun">?</span><span class="pln"> </span><span class="lit">404</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="lit">200</span><span class="pun">);</span><span class="pln"><br />&nbsp; &nbsp; response</span><span class="pun">.</span><span class="kwd">end</span><span class="pun">(</span><span class="pln">data</span><span class="pun">);</span><span class="pln"><br />&nbsp; </span><span class="pun">});</span><span class="pln"><br /></span><span class="pun">};</span><span class="pln"><br /><br /></span><span class="com">// the public method, the only visible property of the module</span><span class="pln"><br />exports</span><span class="pun">.</span><span class="pln">createServer </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; </span><span class="kwd">return</span><span class="pln"> http</span><span class="pun">.</span><span class="pln">createServer</span><span class="pun">(</span><span class="pln">handleRequest</span><span class="pun">);</span><span class="pln"><br /></span><span class="pun">};</span></code></pre></div>

<h3>Let's use it in test now</h3>

<div class="snippet"><a href="testing-private-state-and-mocking-deps/web-server.test.js" class="code-link">web-server.test.js</a><pre><code><span class="com">// Jasmine's syntax http://pivotal.github.com/jasmine/</span><span class="pln"><br />describe</span><span class="pun">(</span><span class="str">'web-server'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; </span><span class="com">// assuming we have mocks module :-D</span><span class="pln"><br />&nbsp; </span><span class="kwd">var</span><span class="pln"> mocks </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'./mocks'</span><span class="pun">);</span><span class="pln"><br />&nbsp; </span><span class="kwd">var</span><span class="pln"> loadModule </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'module-loader'</span><span class="pun">).</span><span class="pln">loadModule</span><span class="pun">;</span><span class="pln"><br />&nbsp; </span><span class="kwd">var</span><span class="pln"> </span><span class="kwd">module</span><span class="pun">,</span><span class="pln"> fsMock</span><span class="pun">,</span><span class="pln"> mockRequest</span><span class="pun">,</span><span class="pln"> mockResponse</span><span class="pun">;</span><span class="pln"><br /><br />&nbsp; beforeEach</span><span class="pun">(</span><span class="kwd">function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; fsMock </span><span class="pun">=</span><span class="pln"> mocks</span><span class="pun">.</span><span class="pln">createFs</span><span class="pun">();</span><span class="pln"><br />&nbsp; &nbsp; mockRequest </span><span class="pun">=</span><span class="pln"> mocks</span><span class="pun">.</span><span class="pln">createRequest</span><span class="pun">();</span><span class="pln"><br />&nbsp; &nbsp; mockResponse </span><span class="pun">=</span><span class="pln"> mocks</span><span class="pun">.</span><span class="pln">createResponse</span><span class="pun">();</span><span class="pln"><br /><br />&nbsp; &nbsp; </span><span class="com">// load the module with mock fs instead of real fs</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="com">// publish all the private state as an object</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="kwd">module</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> loadModule</span><span class="pun">(</span><span class="str">'./web-server.js'</span><span class="pun">,</span><span class="pln"> </span><span class="pun">{</span><span class="pln">fs</span><span class="pun">:</span><span class="pln"> fsMock</span><span class="pun">});</span><span class="pln"><br />&nbsp; </span><span class="pun">});</span><span class="pln"><br /><br />&nbsp; it</span><span class="pun">(</span><span class="str">'extensionFromUrl() should parse basic extensions'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="com">// we are testing private method of the module directly</span><span class="pln"><br />&nbsp; &nbsp; expect</span><span class="pun">(</span><span class="kwd">module</span><span class="pun">.</span><span class="pln">extensionFromUrl</span><span class="pun">(</span><span class="str">'/some.html'</span><span class="pun">)).</span><span class="pln">toBe</span><span class="pun">(</span><span class="str">'html'</span><span class="pun">);</span><span class="pln"><br />&nbsp; &nbsp; expect</span><span class="pun">(</span><span class="kwd">module</span><span class="pun">.</span><span class="pln">extensionFromUrl</span><span class="pun">(</span><span class="str">'/another/file.js'</span><span class="pun">)).</span><span class="pln">toBe</span><span class="pun">(</span><span class="str">'js'</span><span class="pun">);</span><span class="pln"><br />&nbsp; &nbsp; expect</span><span class="pun">(</span><span class="kwd">module</span><span class="pun">.</span><span class="pln">extensionFromUrl</span><span class="pun">(</span><span class="str">'/file.with.more.dots.js'</span><span class="pun">)).</span><span class="pln">toBe</span><span class="pun">(</span><span class="str">'js'</span><span class="pun">);</span><span class="pln"><br />&nbsp; </span><span class="pun">});</span><span class="pln"><br /><br />&nbsp; it</span><span class="pun">(</span><span class="str">'should return 200 if file exists'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="com">// tell the mock, that this file exists</span><span class="pln"><br />&nbsp; &nbsp; fsMock</span><span class="pun">.</span><span class="pln">file</span><span class="pun">(</span><span class="str">'some/file.html'</span><span class="pun">);</span><span class="pln"><br /><br />&nbsp; &nbsp; </span><span class="kwd">module</span><span class="pun">.</span><span class="pln">handleRequest</span><span class="pun">(</span><span class="pln">mockRequest</span><span class="pun">,</span><span class="pln"> mockResponse</span><span class="pun">);</span><span class="pln"><br /><br />&nbsp; &nbsp; </span><span class="com">// wait for finishing the response, it's async</span><span class="pln"><br />&nbsp; &nbsp; waitsFor</span><span class="pun">(</span><span class="kwd">function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">mockResponse</span><span class="pun">.</span><span class="pln">isFinished</span><span class="pun">();});</span><span class="pln"><br />&nbsp; &nbsp; runs</span><span class="pun">(</span><span class="kwd">function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; expect</span><span class="pun">(</span><span class="pln">mockResponse</span><span class="pun">.</span><span class="pln">status</span><span class="pun">).</span><span class="pln">toBe</span><span class="pun">(</span><span class="lit">200</span><span class="pun">);</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="pun">});</span><span class="pln"><br />&nbsp; </span><span class="pun">});</span><span class="pln"><br /></span><span class="pun">});</span></code></pre></div>

<p>This is very simple example of unit testing <code>web-server</code> module, using <code>loadModule</code> function.</p>

<p>We can access both private functions as properties of <code>module</code> now, which is great, because we can
add more tests very easily. For example, you might have noticed, that <code>extensionFromUrl</code> won't
return correct extension when requested url contains query param. Piece of cake, just add a test
that covers this bug:</p>

<pre><code><span class="pln">it</span><span class="pun">(</span><span class="str">'extensionFromUrl() should ignore query params'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; expect</span><span class="pun">(</span><span class="kwd">module</span><span class="pun">.</span><span class="pln">extensionFromUrl</span><span class="pun">(</span><span class="str">'/some.html?param=ignored'</span><span class="pun">)).</span><span class="pln">toBe</span><span class="pun">(</span><span class="str">'html'</span><span class="pun">);</span><span class="pln"><br /></span><span class="pun">});</span><span class="pln"><br /></span></code></pre>

<p>The second test only asserts whether we set proper status code for existing file. We should assert
status code for non existing file as well as caching headers, content type header and many other
stuff. The important point here is, that <strong>it's fast, because it doesn't touch the real filesystem
and still does test what needs to be tested - our code</strong>.</p><hr style="clear:both" /><div class="body" id="disqus_thread"></div>
<script type="text/javascript">
//<![CDATA[
var disqus_url = "http://howtonode.org/testing-private-state-and-mocking-deps";
//]]>
</script>
<script src="http://disqus.com/forums/howtonodeorg/embed.js" type="text/javascript"></script><a href="http://disqus.com/forums/howtonodeorg/?url=ref" class="view-thread">View the discussion thread.</a><a href="http://disqus.com/" class="dsq-brlink">blog comments powered by<span class="logo-disqus">Disqus</span></a>
<script type="text/javascript">
//<![CDATA[
(function() {
  var links = document.getElementsByTagName('a');
  var query = '?';
  for(var i = 0; i < links.length; i++) {
    if(links[i].href.indexOf('#disqus_thread') >= 0) {
      query += 'url' + i + '=' + encodeURIComponent(links[i].href) + '&amp;';
    }
  }
  document.write('<script charset="utf-8" type="text/javascript" src="//disqus.com/forums/howtonodeorg/get_num_replies.js' + query + '"></' + 'script>');
})();


//]]>
</script>
</div></div><div id="sidebar"><div class="aside author"><h4>About the Author</h4><img src="https://www.gravatar.com/avatar/d59bdceef864e67df13167d806d6da63?r=pg&amp;s=200.jpg&amp;d=identicon" class="headshot" /><dl><dt>Name:</dt><dd>Vojta Jina</dd></dl><dl><dt>Github:</dt><dd><a href="https://github.com/vojtajina">vojtajina</a></dd></dl><dl><dt>Twitter:</dt><dd><a href="https://twitter.com/vojtajina">vojtajina</a></dd></dl><dl><dt>Location:</dt><dd>San Mateo, CA</dd></dl></div><div class="aside"><h4>About this Article</h4><a href="http://twitter.com/share" data-count="horizontal" data-via="creationix" class="twitter-share-button">Tweet</a><script src="http://platform.twitter.com/widgets.js"></script><dl title="Sun Jan 08 2012 00:11:06 GMT-0800 (PST)"><dt>Date Released:</dt><dd>Sunday, January  8, 2012</dd></dl><dl><dt>Node Version:</dt><dd><a href="http://github.com/joyent/node/tree/v0.6.5">node v0.6.5</a></dd></dl><dl><dt>Code Samples:</dt><dd><ul><li><a href="testing-private-state-and-mocking-deps/module-loader.js">module-loader.js</a></li><li><a href="testing-private-state-and-mocking-deps/web-server.js">web-server.js</a></li><li><a href="testing-private-state-and-mocking-deps/web-server.test.js">web-server.test.js</a></li></ul></dd></dl><dl><dt>Revisions:</dt><dd><ul></ul></dd></dl></div><div class="bubble"><h3>About HowToNode.org</h3>

<p>HowToNode.org is a community supported blog created by <a href="http://creationix.com/">Tim Caswell</a>. The purpose of the blog is to teach how to do various tasks in <a href="http://nodejs.org/">node.js</a> as well as teach fundamental concepts that are needed to write effective code.</p>

<p>This site is powered by <a href="http://github.com/creationix/wheat">Wheat</a>, a git based blogging engine written in <a href="http://nodejs.org/">node.JS</a>.</p>

<p>The content for this site is stored in a <a href="http://github.com/creationix/howtonode.org">git repository</a> that anyone can fork, write an article, and send a pull request. If your article passes the quality standards it will be published and help support the greater node community.</p></div></div><div id="footer"><p>&copy; 2011-2014 Tim Caswell under the MIT license.</p><p>Content and articles are copyrighted to the individual authors. Design by&nbsp;<a href="https://bengourley.co.uk/">Ben Gourley</a>. All code snippets used in the examples are in the public domain.</p><p>Wheat v2 running on node.js v16.4.2</p></div></div>
<script type="text/javascript">
//<![CDATA[
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
//]]>
</script>

<script type="text/javascript">
//<![CDATA[
try {
var pageTracker = _gat._getTracker("UA-12824411-1");
pageTracker._trackPageview();
} catch(err) {}
//]]>
</script>
</body>
<!-- Mirrored from localhost:8080/testing-private-state-and-mocking-deps by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 13 Jul 2021 13:57:07 GMT -->
</html>